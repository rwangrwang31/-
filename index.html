<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NO GAME NO LIFE | DISBOARD ONLINE</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Noto+Sans+SC:wght@300;400;500;700&family=ZCOOL+XiaoWei&display=swap" rel="stylesheet">
    <style>
        /* ================= STYLE CONFIG ================= */
        :root {
            --pink: #ff2a6d; --cyan: #05d9e8; --purple: #bd00ff; --gold: #ffd700;
            --dark: #09000f; --glass: rgba(20, 20, 35, 0.85); --border: rgba(255, 255, 255, 0.15);
        }
        * { margin:0; padding:0; box-sizing:border-box; cursor:none; outline:none; user-select:none; }
        body { background:var(--dark); color:white; font-family:'Noto Sans SC'; height:100vh; overflow:hidden; }
        body.unlocked { overflow-y:auto; overflow-x:hidden; }

        /* Cursor & Scroll */
        #cursor { width:20px; height:20px; border:2px solid var(--cyan); border-radius:50%; position:fixed; z-index:999999; pointer-events:none; transform:translate(-50%,-50%); transition:0.1s; mix-blend-mode:difference; }
        #cursor.hover { width:50px; height:50px; background:rgba(255,42,109,0.3); border-color:var(--pink); }
        ::-webkit-scrollbar { width:6px; } ::-webkit-scrollbar-track { background:#000; } ::-webkit-scrollbar-thumb { background:linear-gradient(var(--cyan),var(--purple)); border-radius:3px; }

        /* Backgrounds */
        .bg-layer { position:fixed; inset:0; z-index:-10; background:radial-gradient(circle at 50% 0%, rgba(189,0,255,0.15), transparent 70%), url("data:image/svg+xml,%3Csvg width='40' height='40' viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0 0h40v40H0z' fill='none'/%3E%3Cpath d='M0 38h40v2H0z' fill='%2305d9e8' fill-opacity='0.05'/%3E%3Cpath d='M0 0h2v40H0z' fill='%2305d9e8' fill-opacity='0.05'/%3E%3C/svg%3E"); }
        #bg-canvas { position:fixed; inset:0; z-index:-5; opacity:0.6; }

        /* Login Overlay */
        #auth-layer { position:fixed; inset:0; z-index:10000; background:rgba(5,1,10,0.95); display:flex; justify-content:center; align-items:center; backdrop-filter:blur(15px); }
        .auth-box { width:400px; padding:40px; background:rgba(0,0,0,0.8); border:2px solid var(--pink); text-align:center; box-shadow:0 0 60px rgba(255,42,109,0.25); position:relative; }
        .auth-box::before { content:"SYSTEM ACCESS"; position:absolute; top:-12px; left:50%; transform:translate(-50%); background:#000; padding:0 10px; color:var(--pink); font-family:'Orbitron'; font-size:0.8rem; border:1px solid var(--pink); }
        .auth-inp { width:100%; padding:15px; background:rgba(255,255,255,0.05); border:1px solid #444; color:white; margin-bottom:15px; text-align:center; font-family:'Orbitron'; transition:0.3s; }
        .auth-inp:focus { border-color:var(--cyan); background:rgba(5,217,232,0.05); }
        .auth-btn { width:100%; padding:12px; background:var(--pink); color:white; font-family:'Orbitron'; font-weight:bold; border:none; cursor:pointer; transition:0.3s; clip-path:polygon(10px 0, 100% 0, 100% calc(100% - 10px), calc(100% - 10px) 100%, 0 100%, 0 10px); }
        .auth-btn:hover { background:white; color:var(--pink); box-shadow:0 0 20px var(--pink); }
        .auth-btn:disabled { background:#555; color:#999; }
        .hidden { display:none!important; }
        .link { margin-top:15px; font-size:0.8rem; color:#888; text-decoration:underline; cursor:pointer; }

        /* Main App */
        #app-wrap { transition:1s; filter:blur(20px); opacity:0; pointer-events:none; width:100%; }
        body.unlocked #app-wrap { filter:blur(0); opacity:1; pointer-events:all; }
        
        nav { position:fixed; top:0; width:100%; height:70px; padding:0 40px; display:flex; justify-content:space-between; align-items:center; z-index:1000; background:rgba(5,1,10,0.9); border-bottom:1px solid var(--border); }
        .brand { font-family:'Orbitron'; font-weight:900; color:var(--cyan); font-size:1.5rem; text-shadow:0 0 10px var(--cyan); }
        .nav-item { margin-left:20px; color:#aaa; text-decoration:none; font-family:'Orbitron'; font-size:0.9rem; transition:0.3s; }
        .nav-item:hover { color:var(--pink); text-shadow:0 0 8px var(--pink); }

        /* Hero & Glitch */
        .hero { height:100vh; display:flex; flex-direction:column; justify-content:center; align-items:center; text-align:center; }
        .glitch { font-family:'Orbitron'; font-size:5rem; position:relative; color:white; animation:shake 4s infinite; }
        .glitch::before, .glitch::after { content:attr(data-text); position:absolute; top:0; left:0; width:100%; opacity:0.8; }
        .glitch::before { left:2px; text-shadow:-2px 0 #ff00c1; clip-path:inset(0 0 0 0); animation:glitch-a 3s infinite linear alternate-reverse; }
        .glitch::after { left:-2px; text-shadow:-2px 0 #00fff9; clip-path:inset(0 0 0 0); animation:glitch-b 2s infinite linear alternate-reverse; }
        @keyframes shake { 0%,100% {transform:translate(0,0)} 50% {transform:translate(1px,-1px)} }
        @keyframes glitch-a { 0% {clip-path:inset(10% 0 80% 0)} 20% {clip-path:inset(80% 0 10% 0)} }
        @keyframes glitch-b { 0% {clip-path:inset(30% 0 50% 0)} 20% {clip-path:inset(10% 0 60% 0)} }

        /* Content Cards */
        section { padding:80px 20px; max-width:1200px; margin:0 auto; }
        .title { font-family:'Orbitron'; font-size:3rem; text-align:center; margin-bottom:50px; text-shadow:0 0 20px var(--purple); }
        .grid { display:grid; grid-template-columns:repeat(auto-fit, minmax(280px, 1fr)); gap:20px; }
        .card { background:var(--glass); border:1px solid var(--border); padding:25px; border-radius:8px; transition:0.4s; position:relative; overflow:hidden; }
        .card:hover { transform:translateY(-5px); border-color:var(--cyan); box-shadow:0 0 20px rgba(5,217,232,0.2); }
        
        /* Reader Overlay */
        #reader { position:fixed; inset:0; background:#000; z-index:5000; display:flex; flex-direction:column; opacity:0; pointer-events:none; transition:0.3s; }
        #reader.active { opacity:1; pointer-events:all; }
        .r-head { height:60px; border-bottom:1px solid #333; display:flex; justify-content:space-between; align-items:center; padding:0 30px; background:#111; }
        .r-body { flex:1; display:flex; overflow:hidden; }
        .side-l { width:260px; background:#0a0a0a; border-right:1px solid #333; display:flex; flex-direction:column; }
        .toc-item { padding:12px 20px; color:#888; border-bottom:1px solid #222; font-size:0.85rem; transition:0.2s; }
        .toc-item:hover { background:#222; color:white; border-left:3px solid var(--cyan); }
        .text-area { flex:1; overflow-y:auto; padding:50px 100px; font-family:'ZCOOL XiaoWei'; font-size:1.3rem; line-height:2; color:#ddd; }
        .line { padding:2px 0; position:relative; }
        .line:hover { background:#111; }
        .bubble { position:absolute; right:-30px; top:0; color:var(--purple); opacity:0; transition:0.2s; cursor:pointer; }
        .line:hover .bubble { opacity:1; right:10px; }
        
        .side-r { width:0; background:#0a0a0a; border-left:1px solid #333; transition:0.3s; display:flex; flex-direction:column; z-index:50; }
        .side-r.open { width:320px; }
        .cmt-list { flex:1; overflow-y:auto; padding:15px; }
        .cmt-box { background:#1a1a1a; padding:10px; margin-bottom:10px; border-radius:5px; font-size:0.9rem; border:1px solid transparent; }
        .cmt-box:hover { border-color:var(--pink); }
        
        /* Mobile */
        @media(max-width:768px) { .side-l { display:none; } .text-area { padding:20px; } .side-r.open { width:85%; position:absolute; right:0; height:100%; } .auth-box { width:90%; padding:20px; } }
    </style>
</head>
<body>

    <div id="cursor"></div>

    <!-- LOGIN -->
    <div id="auth-layer">
        <div class="auth-box">
            <h2 id="auth-title" style="font-family:'Orbitron'; color:white; margin-bottom:20px;">SYSTEM LOGIN</h2>
            
            <div id="v-login">
                <input id="l-email" class="auth-inp" placeholder="EMAIL">
                <input id="l-pass" type="password" class="auth-inp" placeholder="PASSWORD">
                <button class="auth-btn" onclick="apiLogin()">CONNECT</button>
                <div class="link" onclick="view('reg1')">New Player? Register</div>
                <div class="link" onclick="view('reset1')">Forgot Password?</div>
            </div>

            <div id="v-reg1" class="hidden">
                <input id="r-user" class="auth-inp" placeholder="USERNAME">
                <input id="r-email" class="auth-inp" placeholder="EMAIL">
                <input id="r-pass" type="password" class="auth-inp" placeholder="PASSWORD">
                <button class="auth-btn" onclick="apiCode()">GET CODE</button>
                <div class="link" onclick="view('login')">BACK</div>
            </div>

            <div id="v-reg2" class="hidden">
                <p style="color:#888; font-size:0.8rem; margin-bottom:10px;">Code sent (Test: 123456)</p>
                <input id="r-code" class="auth-inp" placeholder="6-DIGIT CODE">
                <button class="auth-btn" onclick="apiReg()">CONFIRM</button>
            </div>

            <div id="v-reset1" class="hidden">
                <input id="f-email" class="auth-inp" placeholder="EMAIL">
                <button class="auth-btn" onclick="apiResetCode()">SEND CODE</button>
                <div class="link" onclick="view('login')">BACK</div>
            </div>

            <div id="v-reset2" class="hidden">
                <input id="f-code" class="auth-inp" placeholder="CODE">
                <input id="f-pass" type="password" class="auth-inp" placeholder="NEW PASSWORD">
                <button class="auth-btn" onclick="apiResetConf()">UPDATE</button>
            </div>

            <div id="msg" style="color:var(--pink); margin-top:10px; font-family:'Orbitron'; font-size:0.8rem;"></div>
        </div>
    </div>

    <!-- MAIN -->
    <div id="app-wrap">
        <div class="bg-layer"></div>
        <canvas id="bg-canvas"></canvas>
        
        <nav>
            <span class="brand">NGNL</span>
            <div class="nav-links">
                <a href="#hero" class="nav-item">HOME</a>
                <a href="#pledges" class="nav-item">PLEDGES</a>
                <a href="#world" class="nav-item">WORLD</a>
                <span id="u-name" style="color:var(--gold); border:1px solid var(--gold); padding:2px 8px; margin-left:20px;">GUEST</span>
                <span id="u-coins" style="color:var(--cyan); font-size:0.8rem; margin-left:5px;"></span>
            </div>
        </nav>

        <header id="hero" class="hero">
            <h1 class="glitch" data-text="NO GAME NO LIFE">NO GAME NO LIFE</h1>
            <p style="color:#aaa; letter-spacing:3px; margin-bottom:40px;">THE WORLD IS JUST A GAME</p>
            <button class="auth-btn" style="width:auto; padding:10px 40px; background:transparent; border-color:var(--pink); color:var(--pink);" onclick="readerOpen()">READ NOVEL</button>
        </header>

        <section id="pledges">
            <h2 class="title">THE TEN PLEDGES</h2>
            <div class="grid">
                <div class="card">I. Á¶ÅÊ≠¢ÊùÄ‰º§„ÄÅÊàò‰∫â‰∏éÊé†Â§∫</div>
                <div class="card">II. ÊâÄÊúâÁ∫†Á∫∑ÈÄöËøáÊ∏∏ÊàèËß£ÂÜ≥</div>
                <div class="card">III. ËµåÊ≥®ÂøÖÈ°ªÂØπÁ≠â</div>
                <div class="card">IV. ÂÜÖÂÆπ‰∏çÈôê (‰∏çËøùËßÑIII)</div>
                <div class="card">V. ÂèóÊåëÊàòÊñπÂÜ≥ÂÆöÂÜÖÂÆπ</div>
                <div class="card">VI. ÁõüÁ∫¶ÂøÖÈ°ªÈÅµÂÆà</div>
                <div class="card">VII. ÈõÜÂõ¢Á∫†Á∫∑ÊåáÂÆö‰ª£ÁêÜ‰∫∫</div>
                <div class="card">VIII. ‰ΩúÂºäË¥•Èú≤Âç≥Ë¥•Âåó</div>
                <div class="card">IX. ËßÑÂàôÁªùÂØπ‰∏çÂèò</div>
                <div class="card">X. Â§ßÂÆ∂‰∏ÄËµ∑ÂíåÂπ≥Âú∞Áé©Âêß</div>
            </div>
        </section>
    </div>

    <!-- READER -->
    <div id="reader">
        <div class="r-head">
            <span style="color:var(--cyan); font-family:'Orbitron'">ARCHIVE</span>
            <button onclick="readerClose()" style="background:none; border:1px solid var(--pink); color:var(--pink); padding:5px 15px; font-family:'Orbitron'; cursor:pointer;">EXIT</button>
        </div>
        <div class="r-body">
            <div class="side-l">
                <div style="padding:15px; color:#666; text-align:center; font-family:'Orbitron';">INDEX</div>
                <div id="toc" class="toc-list"></div>
            </div>
            <div class="text-area">
                <div id="content" style="min-height:500px;">
                    <div style="text-align:center; margin-top:100px;">
                        <p style="color:#666;">NO DATA LOADED</p>
                        <button class="auth-btn" style="width:auto; margin-top:20px;" onclick="document.getElementById('f-in').click()">LOAD FILE</button>
                    </div>
                </div>
                <div style="padding:20px; display:flex; justify-content:center; gap:20px;">
                    <button class="auth-btn" style="width:auto;" onclick="turn(-1)">PREV</button>
                    <span id="pg" style="color:#888; align-self:center;">0%</span>
                    <button class="auth-btn" style="width:auto;" onclick="turn(1)">NEXT</button>
                </div>
                <!-- DISC -->
                <div style="margin-top:50px; border-top:2px solid var(--cyan); padding-top:30px;">
                    <h3 style="color:var(--cyan); font-family:'Orbitron'">DISCUSSION</h3>
                    <textarea id="d-inp" style="width:100%; background:#111; border:1px solid #333; color:white; padding:10px; margin-top:10px;" rows="2"></textarea>
                    <button class="auth-btn" style="width:100%; margin-top:10px;" onclick="postDisc()">POST</button>
                    <div id="d-list" style="margin-top:20px;"></div>
                </div>
            </div>
            <div id="side-r" class="side-r">
                <div style="padding:15px; border-bottom:1px solid #333; display:flex; justify-content:space-between;">
                    <span style="color:var(--pink)">COMMENTS</span><span onclick="toggleR()" style="cursor:pointer">X</span>
                </div>
                <div id="c-list" class="cmt-list"></div>
                <div style="padding:15px; background:#111;">
                    <textarea id="c-inp" style="width:100%; background:#222; border:none; color:white; padding:10px;" rows="2"></textarea>
                    <button class="auth-btn" style="margin-top:5px;" onclick="postCmt()">POST</button>
                </div>
            </div>
        </div>
    </div>
    <input type="file" id="f-in" style="display:none" onchange="fileIn(this)">

    <script>
        // ==============================================
        // ‚ö†Ô∏è Â°´ÂÖ•‰Ω†ÁöÑ API
        const API = "https://script.google.com/macros/s/AKfycbxJBrAx1_jzwNCO6kCSVyJsNANGE4ibdXy5SXva_p54B4Zot8OaJeCm3PdQsIVhdU4v/exec"; 
        // ==============================================

        let user={name:"Guest", rank:16, coins:0}, lines=[], cur=0, curCmt=-1;
        const PGS=150;

        async function req(d) {
            try {
                const r = await fetch(API, { method:'POST', redirect:'follow', headers:{'Content-Type':'text/plain;charset=utf-8'}, body:JSON.stringify(d) });
                return await r.json();
            } catch(e) { return {status:'error', message:'Net Err'}; }
        }

        // Auth
        function view(v) {
            ['v-login','v-reg1','v-reg2','v-reset1','v-reset2'].forEach(id=>document.getElementById(id).classList.add('hidden'));
            document.getElementById('v-'+v).classList.remove('hidden');
            document.getElementById('msg').innerText="";
        }
        async function apiLogin() {
            const e=document.getElementById('l-email').value, p=document.getElementById('l-pass').value;
            if(!e||!p) return;
            const r = await req({action:'login', email:e, password:p});
            if(r.status==='success') {
                user = {name:r.username, rank:r.level, coins:r.coins};
                document.getElementById('auth-layer').style.display='none';
                document.body.classList.add('unlocked');
                document.getElementById('u-name').innerText = user.name.toUpperCase();
                document.getElementById('u-coins').innerText = `ü™ô ${user.coins}`;
                vis();
            } else document.getElementById('msg').innerText=r.message;
        }
        let tr={};
        async function apiCode() {
            const u=document.getElementById('r-user').value, e=document.getElementById('r-email').value, p=document.getElementById('r-pass').value;
            if(!u||!e)return;
            const r = await req({action:'req_code', email:e});
            if(r.status==='success') { tr={u,e,p}; view('reg2'); } else document.getElementById('msg').innerText=r.message;
        }
        async function apiReg() {
            const c=document.getElementById('r-code').value;
            const r = await req({action:'register', username:tr.u, email:tr.e, password:tr.p, code:c});
            if(r.status==='success') { alert("Success"); view('login'); } else document.getElementById('msg').innerText=r.message;
        }
        // Reset
        let trResetEmail = "";
        async function apiResetCode() {
            const e = document.getElementById('f-email').value;
            if(!e) return;
            const r = await req({action:'req_reset', email:e});
            if(r.status==='success') { trResetEmail=e; view('reset2'); } else document.getElementById('msg').innerText=r.message;
        }
        async function apiResetConf() {
            const c = document.getElementById('f-code').value, p = document.getElementById('f-pass').value;
            const r = await req({action:'confirm_reset', email:trResetEmail, code:c, password:p});
            if(r.status==='success') { alert("Updated"); view('login'); } else document.getElementById('msg').innerText=r.message;
        }

        // Reader
        function readerOpen() { document.getElementById('reader').classList.add('active'); fetch('novel.txt').then(r=>{if(r.ok)return r.text();throw 1}).then(t=>loadTxt(t)).catch(()=>{}); }
        function readerClose() { document.getElementById('reader').classList.remove('active'); }
        function fileIn(i) { const r=new FileReader(); r.onload=e=>loadTxt(e.target.result); r.readAsText(i.files[0]); }
        
        async function loadTxt(t) {
            lines = t.split('\n');
            let h="";
            for(let i=0; i<lines.length; i+=2000) {
                let end=Math.min(i+2000, lines.length);
                for(let j=i; j<end; j++) if(lines[j].match(/(Chapter|Á¨¨.+Á´†|Â∫èÁ´†)/i) && lines[j].length<50) h+=`<div class="toc-item" onclick="go(${j})">${lines[j]}</div>`;
                await new Promise(r=>setTimeout(r,0));
            }
            document.getElementById('toc').innerHTML = h;
            go(0);
        }
        function go(i) { cur=i; render(); }
        function turn(d) { let n=cur+d*PGS; if(n>=0 && n<lines.length) { cur=n; render(); } }
        function render() {
            let end=Math.min(cur+PGS, lines.length);
            document.getElementById('content').innerHTML = lines.slice(cur, end).map((l,i)=>l.trim()?`<div class="line">${l}<div class="bubble" onclick="cmt(${cur+i})">üí¨</div></div>`:"<br>").join('');
            document.getElementById('pg').innerText = Math.round((end/lines.length)*100)+"%";
            if(end>=lines.length) loadDisc();
        }

        // Social
        function toggleR() { document.getElementById('side-r').classList.toggle('open'); }
        async function cmt(i) {
            curCmt=i; document.getElementById('side-r').classList.add('open');
            const div=document.getElementById('c-list'); div.innerHTML="Loading...";
            const r=await req({action:'get_line_comments', line_index:i});
            div.innerHTML = r.data.map(c=>`<div class="cmt-box"><div style="color:var(--cyan)">${c.user} <span style="float:right;cursor:pointer" onclick="act('like','${c.id}','comment')">‚ô• ${c.likes}</span></div>${c.content}</div>`).join('') || "No comments";
        }
        async function postCmt() {
            const t=document.getElementById('c-inp').value;
            if(!t)return;
            await req({action:'post_line_comment', line_index:curCmt, username:user.name, content:t});
            document.getElementById('c-inp').value=""; cmt(curCmt);
        }
        async function loadDisc() {
            const r=await req({action:'get_discussion'});
            document.getElementById('d-list').innerHTML = r.data.map(d=>`<div class="cmt-box"><div style="color:var(--cyan)">${d.user} <span style="color:var(--gold)">ü™ô ${d.coins}</span></div>${d.content}<div style="margin-top:5px;color:#888;cursor:pointer;display:flex;gap:15px"><span onclick="act('like','${d.id}','disc')">‚ô• ${d.likes}</span><span style="color:var(--gold)" onclick="act('tip','${d.id}','disc')">TIP</span></div></div>`).join('');
        }
        async function postDisc() {
            const t=document.getElementById('d-inp').value;
            await req({action:'post_discussion', username:user.name, content:t});
            document.getElementById('d-inp').value=""; loadDisc();
        }
        async function act(a,id,t) {
            if(user.name==='Guest') return alert("Login");
            if(a==='tip' && !confirm('1 Coin?')) return;
            const r=await req({action:'interact', sub_action:a, type:t, id:id, username:user.name, target_id:id});
            if(r.status==='success') {
                if(a==='tip') { user.coins=r.new_balance; document.getElementById('u-coins').innerText=`ü™ô ${user.coins}`; }
                if(t==='comment') cmt(curCmt); else loadDisc();
            } else alert(r.message);
        }

        // Visuals
        function vis() {
            const c=document.getElementById('bg-canvas'), x=c.getContext('2d');
            let w=window.innerWidth, h=window.innerHeight; c.width=w; c.height=h;
            const p=Array.from({length:40},()=>({x:Math.random()*w,y:Math.random()*h,s:Math.random()+0.5,t:['‚ôî','‚ôï'][Math.floor(Math.random()*2)]}));
            function l(){x.clearRect(0,0,w,h);p.forEach(i=>{i.y+=i.s;if(i.y>h)i.y=-20;x.fillStyle='rgba(255,255,255,0.1)';x.font='20px Arial';x.fillText(i.t,i.x,i.y)});requestAnimationFrame(l)}
            l();
        }
        const cur=document.getElementById('cursor');
        document.addEventListener('mousemove',e=>{cur.style.left=e.clientX+'px';cur.style.top=e.clientY+'px'});
        document.body.addEventListener('mouseover',e=>{if(e.target.closest('.hover, .btn, .auth-btn, .link, .toc-item, .bubble, .cmt-box span')) cur.classList.add('hover'); else cur.classList.remove('hover')});
    </script>
</body>
</html>