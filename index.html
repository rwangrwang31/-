<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NO GAME NO LIFE - æ¸¸æˆäººç”Ÿ | SYSTEM LOGIN</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Noto+Sans+SC:wght@300;400;500;700&family=ZCOOL+XiaoWei&display=swap" rel="stylesheet">
    <style>
        /* ================= GLOBAL VARS ================= */
        :root {
            --primary-pink: #ff2a6d;
            --primary-cyan: #05d9e8;
            --primary-purple: #d905e8;
            --primary-gold: #ffd700;
            --dark-bg: #11001c;
            --glass-bg: rgba(20, 20, 35, 0.8);
            --glass-border: rgba(255, 255, 255, 0.15);
            --hud-bg: rgba(10, 5, 15, 0.98);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; cursor: none; }
        
        body {
            background-color: var(--dark-bg);
            color: white;
            font-family: 'Noto Sans SC', sans-serif;
            min-height: 100vh;
            overflow: hidden; /* Locked until login */
        }
        
        body.unlocked { overflow-x: hidden; overflow-y: auto; }

        /* ================= UI COMPONENTS ================= */
        
        /* Cursor */
        #cursor {
            width: 20px; height: 20px; border: 2px solid var(--primary-cyan); border-radius: 50%;
            position: fixed; pointer-events: none; z-index: 999999; transform: translate(-50%, -50%);
            transition: width 0.2s, height 0.2s, background 0.2s; mix-blend-mode: difference;
        }
        #cursor.hovered { width: 50px; height: 50px; background: rgba(255, 42, 109, 0.2); border-color: var(--primary-pink); }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #050505; }
        ::-webkit-scrollbar-thumb { background: var(--primary-cyan); border-radius: 3px; }

        /* Buttons */
        .login-btn, .ctrl-btn, .send-btn {
            background: transparent; border: 1px solid var(--primary-cyan); color: var(--primary-cyan);
            font-family: 'Orbitron'; cursor: none; font-weight: bold; transition: 0.3s; text-transform: uppercase;
        }
        .login-btn:hover, .ctrl-btn:hover, .send-btn:hover { background: var(--primary-cyan); color: black; box-shadow: 0 0 15px var(--primary-cyan); }
        .login-btn:disabled { border-color: #555; color: #555; cursor: wait; background: transparent; box-shadow: none; }

        /* Inputs */
        .login-input, .quick-input {
            background: rgba(255,255,255,0.1); border: 1px solid #555; color: white;
            font-family: 'Orbitron', sans-serif; outline: none; transition: 0.3s;
        }
        .login-input:focus, .quick-input:focus { border-color: var(--primary-cyan); box-shadow: 0 0 10px rgba(5, 217, 232, 0.2); }

        /* ================= LAYERS ================= */

        /* 1. Login Overlay */
        #login-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 100000;
            display: flex; justify-content: center; align-items: center;
            background: rgba(10, 5, 20, 0.8); backdrop-filter: blur(10px);
        }
        .login-box {
            width: 420px; padding: 40px; background: rgba(0, 0, 0, 0.9);
            border: 2px solid var(--primary-pink); box-shadow: 0 0 50px rgba(255, 42, 109, 0.3);
            text-align: center; position: relative;
        }
        .login-box::before {
            content: "CHALLENGER DETECTED"; position: absolute; top: -12px; left: 50%; transform: translateX(-50%);
            background: #000; padding: 0 10px; color: var(--primary-pink); font-family: 'Orbitron'; font-size: 0.8rem;
        }
        .input-group { margin-bottom: 15px; display: flex; gap: 10px; }
        .login-input { width: 100%; padding: 12px; text-align: center; font-size: 1rem; }
        .login-btn { width: 100%; padding: 12px; margin-top: 10px; border-color: var(--primary-pink); color: var(--primary-pink); }
        .login-btn:hover { background: var(--primary-pink); color: white; box-shadow: 0 0 20px var(--primary-pink); }
        .toggle-link { margin-top: 15px; font-size: 0.8rem; color: #888; text-decoration: underline; cursor: none; }
        .toggle-link:hover { color: var(--primary-cyan); }
        .hidden { display: none; }
        #error-msg { color: #ff2a6d; margin-top: 15px; font-size: 0.9rem; letter-spacing: 1px; font-family: 'Orbitron'; }

        /* 2. Site Wrapper (Main Content) */
        #site-wrapper {
            transition: filter 0.8s ease, opacity 0.8s ease;
            filter: blur(15px); opacity: 0.5; pointer-events: none;
            width: 100%; min-height: 100vh;
        }
        body.unlocked #site-wrapper { filter: blur(0); pointer-events: all; opacity: 1; }

        .bg-layer {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -2;
            background-image: 
                radial-gradient(circle at 50% 50%, rgba(217, 5, 232, 0.05) 0%, transparent 60%),
                url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0 0h30v30H0zM30 30h30v30H30z' fill='%2305d9e8' fill-opacity='0.03'/%3E%3C/svg%3E");
        }
        #bg-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; }

        /* 3. Navbar */
        nav {
            position: fixed; top: 0; width: 100%; padding: 20px 50px;
            display: flex; justify-content: space-between; align-items: center;
            z-index: 100; backdrop-filter: blur(10px); background: rgba(0,0,0,0.5); border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .nav-links a { color: white; text-decoration: none; margin-left: 30px; font-family: 'Orbitron'; font-size: 0.9rem; transition: 0.3s; }
        .nav-links a:hover { color: var(--primary-cyan); text-shadow: 0 0 8px var(--primary-cyan); }

        /* 4. Sections */
        section { padding: 100px 20px; position: relative; }
        .section-title {
            font-family: 'Orbitron'; font-size: 3rem; text-align: center; margin-bottom: 60px;
            background: linear-gradient(to bottom, #fff, #aaa); -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            text-shadow: 0 0 30px rgba(5, 217, 232, 0.3); letter-spacing: 5px;
        }

        /* World: Chess Board */
        .world-container { max-width: 1200px; margin: 0 auto; background: rgba(0,0,0,0.6); border: 1px solid var(--glass-border); border-radius: 10px; overflow: hidden; }
        .world-tabs { display: flex; border-bottom: 1px solid var(--primary-cyan); background: rgba(5,217,232,0.1); }
        .world-tab { flex: 1; padding: 20px; text-align: center; font-family: 'Orbitron'; color: #888; cursor: none; transition: 0.3s; border-right: 1px solid rgba(255,255,255,0.1); }
        .world-tab.active { color: white; background: rgba(5,217,232,0.2); text-shadow: 0 0 10px var(--primary-cyan); }
        .world-content { padding: 40px; min-height: 400px; color: #ddd; }
        
        .exceed-board { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; margin-top: 20px; }
        .piece-card {
            background: rgba(255,255,255,0.03); border: 1px solid var(--glass-border); border-radius: 8px; padding: 20px;
            position: relative; overflow: hidden; height: 200px; display: flex; flex-direction: column; justify-content: space-between; transition: 0.4s;
        }
        .piece-card:hover { transform: translateY(-5px); background: rgba(255,255,255,0.08); box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .piece-icon { position: absolute; bottom: -20px; right: -20px; font-size: 8rem; opacity: 0.1; color: white; pointer-events: none; transition: 0.5s; }
        .piece-card:hover .piece-icon { opacity: 0.3; transform: scale(1.2) rotate(-10deg); }
        .piece-rank { font-family: 'Orbitron'; font-size: 2.5rem; font-weight: 900; opacity: 0.2; position: absolute; top: 10px; left: 15px; }
        .piece-name { font-family: 'Orbitron'; font-weight: bold; font-size: 1.2rem; color: var(--primary-cyan); }
        .piece-jp-name { font-family: 'Noto Sans SC'; font-size: 0.9rem; color: #ddd; margin-bottom: 5px; }
        .piece-desc { font-size: 0.8rem; color: #888; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 8px; }
        .piece-card.rank-1 .piece-name { color: var(--primary-gold); } .piece-card.rank-1 { border-color: var(--primary-gold); }
        .piece-card.rank-16:hover { animation: rainbow-border 2s infinite linear; }
        @keyframes rainbow-border { 0% { box-shadow: 0 0 10px var(--primary-pink); } 50% { box-shadow: 0 0 10px var(--primary-cyan); } 100% { box-shadow: 0 0 10px var(--primary-purple); } }

        /* ================= READER PRO (Social) ================= */
        #novel-reader {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--hud-bg);
            z-index: 5000; display: flex; flex-direction: row; opacity: 0; pointer-events: none; transition: opacity 0.5s;
        }
        #novel-reader.active { opacity: 1; pointer-events: all; }

        /* Left Sidebar */
        .sidebar-left { width: 250px; background: rgba(0,0,0,0.5); border-right: 1px solid var(--glass-border); display: flex; flex-direction: column; }
        .toc-header { padding: 20px; font-family: 'Orbitron'; color: var(--primary-cyan); border-bottom: 1px solid var(--glass-border); text-align: center; }
        .toc-list { flex: 1; overflow-y: auto; }
        .toc-item { padding: 12px 20px; font-size: 0.9rem; color: #aaa; border-bottom: 1px solid rgba(255,255,255,0.05); transition: 0.2s; }
        .toc-item:hover { color: white; background: rgba(5,217,232,0.1); padding-left: 25px; }

        /* Center Content */
        .reader-main { flex: 1; position: relative; display: flex; flex-direction: column; }
        .reader-header { height: 60px; display: flex; justify-content: space-between; align-items: center; padding: 0 30px; border-bottom: 1px solid var(--glass-border); background: rgba(0,0,0,0.3); }
        .reader-content { flex: 1; overflow-y: auto; padding: 60px 100px; font-family: 'ZCOOL XiaoWei', serif; font-size: 1.3rem; line-height: 2.2; color: #eee; scroll-behavior: smooth; }
        
        /* Line Comments */
        .story-line { position: relative; padding-right: 40px; border-radius: 4px; margin-bottom: 15px; transition: 0.2s; }
        .story-line:hover { background: rgba(255,255,255,0.05); }
        .comment-bubble { position: absolute; right: 0; top: 0; width: 30px; height: 30px; opacity: 0; transition: 0.3s; display: flex; align-items: center; justify-content: center; cursor: none; }
        .story-line:hover .comment-bubble { opacity: 1; }

        /* Right Sidebar (Comments) */
        .sidebar-right { width: 0; overflow: hidden; background: rgba(10, 5, 20, 0.98); border-left: 1px solid var(--glass-border); transition: width 0.4s; display: flex; flex-direction: column; }
        .sidebar-right.open { width: 350px; }
        .comments-header { padding: 20px; border-bottom: 1px solid var(--primary-pink); color: var(--primary-pink); font-family: 'Orbitron'; display: flex; justify-content: space-between; }
        .comments-list { flex: 1; overflow-y: auto; padding: 20px; }
        .comment-card { background: rgba(255,255,255,0.05); border-radius: 8px; padding: 15px; margin-bottom: 15px; border: 1px solid transparent; }
        .comment-card:hover { border-color: var(--primary-cyan); }
        .user-tag { font-size: 0.8rem; color: var(--primary-gold); font-family: 'Orbitron'; margin-bottom: 5px; display: flex; justify-content: space-between; }
        .comment-text { font-size: 0.95rem; color: #ddd; word-wrap: break-word; }
        .comment-input-area { padding: 20px; border-top: 1px solid var(--glass-border); background: rgba(0,0,0,0.5); }
        .quick-input { width: 100%; padding: 10px; border-radius: 4px; margin-bottom: 10px; resize: none; background: rgba(255,255,255,0.1); color: white; border: 1px solid #444; }
        .send-btn { width: 100%; padding: 10px; background: var(--primary-purple); border: none; border-radius: 4px; color: white; font-family: 'Orbitron'; }

        /* Discussion Zone */
        .discussion-zone { margin-top: 100px; padding: 40px; background: rgba(5, 217, 232, 0.05); border-top: 2px solid var(--primary-cyan); position: relative; }
        .discuss-card { background: rgba(0,0,0,0.6); border: 1px solid var(--glass-border); padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        
        /* Misc */
        .glitch { position: relative; }
        .glitch::before, .glitch::after { content: attr(data-text); position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0.8; }
        .glitch::before { left: 2px; text-shadow: -1px 0 red; clip: rect(24px, 550px, 90px, 0); animation: glitch 3s infinite alternate-reverse; }
        .glitch::after { left: -2px; text-shadow: -1px 0 blue; clip: rect(85px, 550px, 140px, 0); animation: glitch 2s infinite alternate-reverse; }
        @keyframes glitch { 0% { clip: rect(42px, 9999px, 44px, 0); } 100% { clip: rect(12px, 9999px, 100px, 0); } }
        @keyframes shake { 0% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } 100% { transform: translateX(0); } }

        /* Character Gallery Styles */
        .char-gallery { display: flex; justify-content: center; gap: 30px; flex-wrap: wrap; }
        .char-card { width: 260px; height: 380px; perspective: 1000px; }
        .char-inner { width: 100%; height: 100%; transition: transform 0.6s; transform-style: preserve-3d; position: relative; }
        .char-card:hover .char-inner { transform: rotateY(180deg); }
        .char-front, .char-back { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: 15px; display: flex; flex-direction: column; align-items: center; justify-content: center; border: 1px solid var(--primary-purple); box-shadow: 0 0 15px rgba(217,5,232,0.3); background: rgba(20,20,30,0.9); }
        .char-front { background: linear-gradient(135deg, #2a0e36, #000); }
        .char-back { transform: rotateY(180deg); background: linear-gradient(135deg, var(--primary-pink), var(--primary-purple)); padding: 20px; text-align: center; }
        .char-avatar { width: 120px; height: 120px; border-radius: 50%; border: 3px solid white; box-shadow: 0 0 20px var(--primary-pink); background-size: cover; background-position: top center; margin-bottom: 20px; }
        .char-name { font-family: 'Orbitron'; font-size: 1.5rem; color: var(--primary-pink); }
        .char-race { color: var(--primary-cyan); font-size: 0.9rem; }
    </style>
</head>
<body>

    <div id="cursor"></div>

    <!-- LOGIN OVERLAY -->
    <div id="login-overlay">
        <div class="login-box hover-target">
            <h2 class="login-title" id="auth-title" style="font-family:'Orbitron'; color:white; margin-bottom:20px;">SYSTEM LOGIN</h2>
            
            <!-- 1. LOGIN -->
            <div id="login-form">
                <div class="input-group"><input type="email" id="login-email" class="login-input" placeholder="EMAIL"></div>
                <div class="input-group"><input type="password" id="login-password" class="login-input" placeholder="PASSWORD"></div>
                <button class="login-btn hover-target" id="btn-login" onclick="handleLogin()">CONNECT</button>
                <div class="links-row" style="margin-top:15px; display:flex; justify-content:space-between; font-size:0.8rem;">
                    <span class="toggle-link hover-target" onclick="switchAuth('forgot')">FORGOT PASSWORD?</span>
                    <span class="toggle-link hover-target" onclick="switchAuth('register')">REGISTER</span>
                </div>
            </div>

            <!-- 2. REGISTER STEP 1 -->
            <div id="register-step1" class="hidden">
                <div class="input-group"><input type="text" id="reg-user" class="login-input" placeholder="USERNAME"></div>
                <div class="input-group"><input type="email" id="reg-email" class="login-input" placeholder="EMAIL"></div>
                <div class="input-group"><input type="password" id="reg-pass" class="login-input" placeholder="PASSWORD"></div>
                <button class="login-btn hover-target" id="btn-reg-code" onclick="requestRegCode()">GET CODE</button>
                <div class="toggle-link hover-target" onclick="switchAuth('login')" style="text-align:center; display:block; margin-top:10px;">BACK</div>
            </div>

            <!-- 3. REGISTER STEP 2 -->
            <div id="register-step2" class="hidden">
                <p style="color:#ccc; font-size:0.8rem;">Check your email for code</p>
                <div class="input-group"><input type="text" id="reg-code" class="login-input" placeholder="6-DIGIT CODE"></div>
                <button class="login-btn hover-target" id="btn-reg-confirm" onclick="confirmRegister()">CONFIRM</button>
            </div>

            <!-- 4. FORGOT PASSWORD -->
            <div id="forgot-step1" class="hidden">
                <div class="input-group"><input type="email" id="reset-email" class="login-input" placeholder="EMAIL"></div>
                <button class="login-btn hover-target" id="btn-reset-code" onclick="requestResetCode()">SEND CODE</button>
                <div class="toggle-link hover-target" onclick="switchAuth('login')" style="text-align:center; display:block; margin-top:10px;">BACK</div>
            </div>

            <!-- 5. RESET PASSWORD -->
            <div id="forgot-step2" class="hidden">
                <div class="input-group"><input type="text" id="reset-code" class="login-input" placeholder="CODE"></div>
                <div class="input-group"><input type="password" id="new-password" class="login-input" placeholder="NEW PASSWORD"></div>
                <button class="login-btn hover-target" id="btn-reset-confirm" onclick="confirmReset()">UPDATE</button>
            </div>

            <div id="error-msg"></div>
        </div>
    </div>

    <!-- SITE CONTENT -->
    <div id="site-wrapper">
        <div class="bg-layer"></div>
        <canvas id="bg-canvas"></canvas>
        
        <nav>
            <div class="logo">NO GAME NO LIFE</div>
            <div class="nav-links">
                <a href="#hero" class="hover-target">é¦–é¡µ</a>
                <a href="#pledges" class="hover-target">åæ¡ç›Ÿçº¦</a>
                <a href="#world" class="hover-target">ä¸–ç•Œè§‚</a>
                <a href="#characters" class="hover-target">ä¸»è¦äººç‰©</a>
                <span id="nav-user-info" style="color:var(--primary-gold); font-size:0.8rem; border:1px solid var(--primary-gold); padding:2px 5px;">GUEST</span>
            </div>
        </nav>

        <header id="hero" class="hero">
            <h1 class="glitch" data-text="NO GAME NO LIFE">NO GAME NO LIFE</h1>
            <p>åœ¨è¿™ä¸ªä¸€åˆ‡éƒ½ç”±æ¸¸æˆå†³å®šçš„ä¸–ç•Œï¼Œã€Œç©ºç™½ã€å°†æŒ‘æˆ˜ç¥çµã€‚</p>
            <button class="cta-btn hover-target" onclick="openReader()">READ NOVEL</button>
        </header>

        <!-- Pledges -->
        <section id="pledges" class="pledges">
            <h2 class="section-title">THE TEN PLEDGES</h2>
            <div class="pledge-container">
                <div class="pledge-card hover-target"><div class="pledge-num">I</div><div class="pledge-text">è¿™ä¸ªä¸–ç•Œç¦æ­¢ä¸€åˆ‡æ€ä¼¤ã€æˆ˜äº‰ä¸æ å¤ºã€‚</div></div>
                <div class="pledge-card hover-target"><div class="pledge-num">II</div><div class="pledge-text">æ‰€æœ‰çº çº·ä¸€å¾‹é€šè¿‡åœ¨æ¸¸æˆä¸­å†³èƒœè´Ÿæ¥è§£å†³ã€‚</div></div>
                <div class="pledge-card hover-target"><div class="pledge-num">III</div><div class="pledge-text">æ¸¸æˆä¸­é¡»èµŒä¸ŠåŒæ–¹è®¤ä¸ºå¯¹ç­‰çš„èµŒæ³¨ã€‚</div></div>
                <div class="pledge-card hover-target"><div class="pledge-num">IV</div><div class="pledge-text">åœ¨ä¸è¿åç¬¬ä¸‰æ¡çš„æƒ…å†µä¸‹ï¼Œæ¸¸æˆå†…å®¹ã€èµŒæ³¨çš†ä¸é™ã€‚</div></div>
                <div class="pledge-card hover-target"><div class="pledge-num">V</div><div class="pledge-text">å—æŒ‘æˆ˜çš„ä¸€æ–¹æœ‰æƒå†³å®šæ¸¸æˆçš„å†…å®¹ã€‚</div></div>
                <div class="pledge-card hover-target"><div class="pledge-num">VI</div><div class="pledge-text">ã€Œå‘ç›Ÿçº¦å®£èª“ã€çš„èµŒæ³¨ç»å¯¹è¦éµå®ˆã€‚</div></div>
                <div class="pledge-card hover-target"><div class="pledge-num">VII</div><div class="pledge-text">é›†å›¢çº çº·åº”æŒ‡å®šå…¨æƒä»£ç†äººã€‚</div></div>
                <div class="pledge-card hover-target"><div class="pledge-num">VIII</div><div class="pledge-text">æ¸¸æˆä¸­è‹¥æœ‰ä¸æ­£å½“è¡Œä¸ºï¼Œä¸€æ—¦è´¥éœ²å³è§†åŒè´¥åŒ—ã€‚</div></div>
                <div class="pledge-card hover-target"><div class="pledge-num">IX</div><div class="pledge-text">ä»¥ç¥ä¹‹åå®£å¸ƒï¼Œä»¥ä¸Šå„æ¡çš†ä¸ºç»å¯¹ä¸å˜çš„è§„åˆ™ã€‚</div></div>
                <div class="pledge-card hover-target"><div class="pledge-num">X</div><div class="pledge-text">å¤§å®¶ä¸€èµ·å’Œå¹³åœ°ç©å§ã€‚</div></div>
            </div>
        </section>

        <!-- World (16 Races) -->
        <section id="world">
            <h2 class="section-title">WORLD DATABASE</h2>
            <div class="world-container">
                <div class="world-tabs">
                    <div class="world-tab active hover-target" onclick="switchWorldTab('disboard')">DISBOARD</div>
                    <div class="world-tab hover-target" onclick="switchWorldTab('exceed')">IXSEED (16ç§æ—)</div>
                    <div class="world-tab hover-target" onclick="switchWorldTab('history')">ARCHIVE</div>
                </div>
                <div class="world-content" id="world-display-area"></div>
            </div>
        </section>

        <!-- Characters -->
        <section id="characters" class="characters">
            <h2 class="section-title">PLAYERS</h2>
            <div class="char-gallery">
                <div class="char-card hover-target"><div class="char-inner"><div class="char-front"><div class="char-avatar" style="background-image: url('sora.png');"></div><div class="char-name">SORA</div><div class="char-race">Imanity</div></div><div class="char-back"><h3>ç©º (Sora)</h3><p>åå…«å²ã€‚æ— ä¸šã€å¤„ç”·ã€æ²Ÿé€šéšœç¢ã€æ¸¸æˆåºŸäººã€‚æ“…é•¿ç­–ç•¥ä¸è¯»å¿ƒã€‚</p></div></div></div>
                <div class="char-card hover-target"><div class="char-inner"><div class="char-front"><div class="char-avatar" style="background-image: url('shiro.png');"></div><div class="char-name">SHIRO</div><div class="char-race">Imanity</div></div><div class="char-back"><h3>ç™½ (Shiro)</h3><p>åä¸€å²ã€‚ç©ºçš„ä¹‰å¦¹ã€‚æ‹¥æœ‰è¶…ä¹å¸¸äººçš„è®¡ç®—èƒ½åŠ›ã€‚</p></div></div></div>
                <div class="char-card hover-target"><div class="char-inner"><div class="char-front"><div class="char-avatar" style="background-image: url('jibril.png');"></div><div class="char-name">JIBRIL</div><div class="char-race">FlÃ¼gel</div></div><div class="char-back"><h3>å‰æ™®è‰å°”</h3><p>ä½é˜¶åºåˆ—ç¬¬å…­ä½ã€‚æ‹¥æœ‰æå¼ºçš„æˆ˜æ–—åŠ›ä¸çŸ¥è¯†æ¬²ã€‚</p></div></div></div>
                <div class="char-card hover-target"><div class="char-inner"><div class="char-front"><div class="char-avatar" style="background-image: url('steph.png');"></div><div class="char-name">STEPH</div><div class="char-race">Imanity</div></div><div class="char-back"><h3>å²è’‚èŠ¬å¦®</h3><p>è‰¾å°”å¥‡äºšçš„å‰ç‹æ—å­™å¥³ã€‚è¢«â€œç©ºç™½â€æ‰å¼„çš„ç®¡å®¶ã€‚</p></div></div></div>
                <div class="char-card hover-target"><div class="char-inner"><div class="char-front"><div class="char-avatar" style="background-image: url('izuna.png');"></div><div class="char-name">IZUNA</div><div class="char-race">Werebeast</div></div><div class="char-back"><h3>åˆæ¿‘ä¼Šçº²</h3><p>å…«å²ã€‚ä¸œéƒ¨è”åˆçš„å¤§ä½¿ã€‚æ‹¥æœ‰æå…¶æ•é”çš„äº”æ„Ÿã€‚</p></div></div></div>
                <div class="char-card hover-target"><div class="char-inner"><div class="char-front"><div class="char-avatar" style="background-image: url('tet.png');"></div><div class="char-name">TET</div><div class="char-race">One True God</div></div><div class="char-back"><h3>ç‰¹å›¾ (Tet)</h3><p>æ¸¸æˆä¹‹ç¥ï¼Œå”¯ä¸€çš„å…¨æƒç¥ã€‚</p></div></div></div>
            </div>
        </section>

        <footer>
            <p>Â© 2024 Yuu Kamiya, PUBLISHED BY KADOKAWA CORPORATION / NO GAME NO LIFE PARTNERS</p>
            <p>Fan Site Demo - Not Official</p>
        </footer>
    </div>

    <!-- NOVEL READER OVERLAY -->
    <div id="novel-reader">
        <div class="sidebar-left">
            <div class="toc-header">INDEX</div>
            <div class="toc-list" id="toc-list"></div>
        </div>
        <div class="reader-main">
            <div class="reader-header">
                <span style="font-family:'Orbitron'; color:var(--primary-cyan);">NOVEL DATABASE</span>
                <span id="reader-status" style="font-size:0.8rem; color:#aaa;"></span>
                <button onclick="closeReader()" style="background:none; border:1px solid var(--primary-pink); color:var(--primary-pink); padding:5px 15px; font-family:'Orbitron'; cursor:none;">EXIT</button>
            </div>
            <div class="reader-content" id="reader-content"></div>
        </div>
        <div class="sidebar-right" id="comment-sidebar">
            <div class="comments-header">
                <span>COMMENTS</span>
                <span onclick="toggleSidebar()" style="cursor:none;">[X]</span>
            </div>
            <div class="comments-list" id="comments-list"></div>
            <div class="comment-input-area">
                <textarea id="comment-input" class="quick-input" rows="3" placeholder="Type comment..."></textarea>
                <button class="send-btn hover-target" onclick="postComment()">POST</button>
            </div>
        </div>
    </div>
    <input type="file" id="file-input" accept=".txt" style="display:none;" onchange="loadFromFile(this)">

    <script>
        // ========================================================
        // âš ï¸ æ ¸å¿ƒé…ç½®ï¼šæ›¿æ¢ä¸ºä½ çš„ Google Apps Script URL
        const API_URL = "https://script.google.com/macros/s/AKfycbxJBrAx1_jzwNCO6kCSVyJsNANGE4ibdXy5SXva_p54B4Zot8OaJeCm3PdQsIVhdU4v/exec"; 
        // ========================================================

        // User State
        let currentUser = { username: "Guest", level: 16, exp: 0, coins: 0 };
        let currentLineIndex = -1;
        let allLines = [];

        // --- UI Switcher ---
        function switchAuth(mode) {
            const ids = ['login-form', 'register-step1', 'register-step2', 'forgot-step1', 'forgot-step2'];
            ids.forEach(id => document.getElementById(id).classList.add('hidden'));
            document.getElementById('error-msg').innerText = "";
            if(mode === 'login') document.getElementById('login-form').classList.remove('hidden');
            else if(mode === 'register') document.getElementById('register-step1').classList.remove('hidden');
            else if(mode === 'forgot') document.getElementById('forgot-step1').classList.remove('hidden');
        }

        // --- API Helper ---
        async function callApi(data) {
            return fetch(API_URL, {
                method: 'POST',
                redirect: 'follow',
                headers: { "Content-Type": "text/plain;charset=utf-8" },
                body: JSON.stringify(data)
            }).then(res => res.json());
        }

        // --- Login ---
        function handleLogin() {
            const e = document.getElementById('login-email').value;
            const p = document.getElementById('login-password').value;
            const btn = document.getElementById('btn-login');
            const err = document.getElementById('error-msg');
            if(!e || !p) { err.innerText = "INPUT MISSING"; return; }
            
            btn.innerText = "SYNCING..."; btn.disabled = true;
            callApi({action: 'login', email: e, password: p}).then(data => {
                if(data.status === 'success') {
                    currentUser = { username: data.username, level: data.level, exp: data.exp, coins: data.coins };
                    unlockSite();
                } else {
                    err.innerText = data.message; btn.disabled = false; btn.innerText = "CONNECT";
                    document.querySelector('.login-box').style.animation = "shake 0.5s";
                    setTimeout(() => { document.querySelector('.login-box').style.animation = ""; }, 500);
                }
            }).catch(() => { err.innerText = "NETWORK ERROR"; btn.disabled = false; btn.innerText = "CONNECT"; });
        }

        // --- Register & Reset Flow ---
        let tempRegData = {}, tempResetEmail = "";
        function requestRegCode() {
            const u = document.getElementById('reg-user').value, e = document.getElementById('reg-email').value, p = document.getElementById('reg-pass').value;
            if(!u || !e || !p) return;
            document.getElementById('btn-reg-code').innerText = "SENDING...";
            callApi({action: 'req_reg_code', email: e}).then(d => {
                if(d.status === 'success') { tempRegData = {username:u, email:e, password:p}; document.getElementById('register-step1').classList.add('hidden'); document.getElementById('register-step2').classList.remove('hidden'); }
                else { alert(d.message); document.getElementById('btn-reg-code').innerText = "GET CODE"; }
            });
        }
        function confirmRegister() {
            const code = document.getElementById('reg-code').value;
            if(!code) return;
            callApi({action: 'confirm_register', ...tempRegData, code: code}).then(d => {
                if(d.status === 'success') { alert("REGISTERED!"); unlockSiteWithUser(d.username); }
                else alert(d.message);
            });
        }
        function requestResetCode() {
            const e = document.getElementById('reset-email').value;
            if(!e) return;
            callApi({action: 'req_reset_code', email: e}).then(d => {
                if(d.status === 'success') { tempResetEmail = e; document.getElementById('forgot-step1').classList.add('hidden'); document.getElementById('forgot-step2').classList.remove('hidden'); }
                else alert(d.message);
            });
        }
        function confirmReset() {
            const c = document.getElementById('reset-code').value, p = document.getElementById('new-password').value;
            callApi({action: 'confirm_reset', email: tempResetEmail, code: c, password: p}).then(d => {
                if(d.status === 'success') { alert("PASSWORD UPDATED"); switchAuth('login'); }
                else alert(d.message);
            });
        }

        // --- Unlock Logic ---
        function unlockSite() { unlockSiteWithUser(currentUser.username); }
        function unlockSiteWithUser(name) {
            document.getElementById('login-overlay').style.opacity = '0';
            document.body.classList.add('unlocked');
            updateUserDisplay();
            setTimeout(() => { document.getElementById('login-overlay').style.display = 'none'; initSite(); }, 800);
        }
        function updateUserDisplay() {
            const rankStr = numToRoman(currentUser.level);
            document.getElementById('nav-user-info').innerText = `${currentUser.username} [Rank ${rankStr}]`;
            document.getElementById('reader-status').innerText = `${currentUser.username} | EXP: ${currentUser.exp} | COINS: ${currentUser.coins}`;
        }

        // --- Novel Reader Logic ---
        function openReader() {
            document.getElementById('novel-reader').classList.add('active');
            updateUserDisplay();
            fetch('novel.txt').then(r => { if(r.ok) return r.text(); throw new Error(); })
                .then(t => processText(t)).catch(() => document.getElementById('file-input').click());
        }
        function closeReader() { document.getElementById('novel-reader').classList.remove('active'); }
        function loadFromFile(input) { const f = input.files[0]; const r = new FileReader(); r.onload = e => processText(e.target.result); r.readAsText(f); }
        
        function processText(text) {
            allLines = text.split('\n');
            const container = document.getElementById('reader-content');
            const tocList = document.getElementById('toc-list');
            container.innerHTML = ""; tocList.innerHTML = "";
            
            let html = "";
            allLines.forEach((line, index) => {
                if(!line.trim()) return;
                html += `<div class="story-line hover-target">${line} <div class="comment-bubble" onclick="openComments(${index})">ğŸ’¬</div></div>`;
                // Simple TOC detection
                if(line.match(/(ç¬¬.+ç« |Chapter|åºç« |ç»ˆç« )/i)) {
                    const div = document.createElement('div');
                    div.className = 'toc-item hover-target';
                    div.innerText = line;
                    div.onclick = () => {
                        const target = container.children[index]; // Approximate
                        if(target) target.scrollIntoView({behavior:'smooth'});
                    };
                    tocList.appendChild(div);
                }
            });
            
            // Discussion Zone at bottom
            html += `
                <div class="discussion-zone">
                    <h3 style="color:var(--primary-cyan); font-family:'Orbitron'; margin-bottom:20px;">CHAPTER DISCUSSION</h3>
                    <textarea id="discuss-input" class="quick-input" rows="3" placeholder="Share analysis..."></textarea>
                    <button class="send-btn hover-target" onclick="postDiscussion()">POST (+10 EXP)</button>
                    <div id="discussion-list" class="discuss-grid"></div>
                </div>
            `;
            container.innerHTML = html;
            loadDiscussion();
        }

        // --- Comment System ---
        function toggleSidebar() { document.getElementById('comment-sidebar').classList.toggle('open'); }
        function openComments(index) {
            currentLineIndex = index;
            document.getElementById('comment-sidebar').classList.add('open');
            loadLineComments(index);
        }
        function loadLineComments(index) {
            const list = document.getElementById('comments-list');
            list.innerHTML = "<div style='text-align:center; color:#888;'>LOADING...</div>";
            callApi({action: 'get_line_comments', line_index: index}).then(d => {
                list.innerHTML = "";
                if(!d.data || d.data.length === 0) list.innerHTML = "<div style='text-align:center; color:#555;'>NO COMMENTS</div>";
                else d.data.forEach(c => list.innerHTML += createCommentHTML(c));
            });
        }
        function postComment() {
            const c = document.getElementById('comment-input').value;
            if(!c) return;
            // Optimistic update
            const fake = {user: currentUser.username, content: c, likes: 0};
            document.getElementById('comments-list').innerHTML += createCommentHTML(fake);
            document.getElementById('comment-input').value = "";
            callApi({action: 'post_line_comment', line_index: currentLineIndex, username: currentUser.username, content: c});
        }
        function createCommentHTML(c) {
            const content = c.content.replace(/@(\w+)/g, '<span style="color:var(--primary-cyan)">@$1</span>');
            return `
                <div class="comment-card">
                    <div class="user-tag"><span>${c.user}</span><span style="color:#888">â™¥ ${c.likes}</span></div>
                    <div class="comment-text">${content}</div>
                </div>
            `;
        }

        // --- Discussion System ---
        function loadDiscussion() {
            callApi({action: 'get_discussion'}).then(d => {
                const list = document.getElementById('discussion-list');
                if(!list) return;
                list.innerHTML = "";
                d.data.forEach(p => {
                    list.innerHTML += `
                        <div class="discuss-card">
                            <div class="user-tag" style="font-size:1rem; color:var(--primary-cyan); border-bottom:1px solid #444; padding-bottom:10px;">
                                ${p.user} <span style="color:var(--primary-gold); float:right;">ğŸª™ ${p.coins}</span>
                            </div>
                            <div class="comment-text" style="margin:15px 0; font-size:1.1rem;">${p.content}</div>
                            <div style="font-size:0.8rem; color:#888; text-align:right;">${p.time}</div>
                        </div>
                    `;
                });
            });
        }
        function postDiscussion() {
            const c = document.getElementById('discuss-input').value;
            if(!c) return;
            callApi({action: 'post_discussion', username: currentUser.username, content: c}).then(() => {
                alert("POSTED!"); loadDiscussion();
            });
        }

        // --- Visuals & Init ---
        function initSite() {
            const loader = document.getElementById('loader'); loader.style.display = 'flex';
            setTimeout(() => { loader.style.opacity = '1'; }, 10);
            setTimeout(() => { loader.style.opacity = '0'; setTimeout(() => { loader.style.display = 'none'; }, 1000); }, 2000);
            initParticles(); animate();
            renderWorld();
        }
        const canvas = document.getElementById('bg-canvas'); const ctx = canvas.getContext('2d'); let width = window.innerWidth, height = window.innerHeight; canvas.width = width; canvas.height = height; const symbols = ['â™”', 'â™•', 'â™–', 'â™—', 'â™˜', 'â™™', 'â™ ', 'â™¥', 'â™¦', 'â™£', 'â– ', 'â–²']; const particles = [];
        class Particle { constructor() { this.reset(); this.y = Math.random() * height; } reset() { this.x = Math.random() * width; this.y = -20; this.speed = Math.random() * 1.5 + 0.5; this.size = Math.random() * 20 + 10; this.text = symbols[Math.floor(Math.random() * symbols.length)]; this.color = ['#ff2a6d', '#05d9e8', '#d905e8', '#ffffff'][Math.floor(Math.random() * 4)]; this.opacity = Math.random() * 0.5 + 0.1; this.rotation = Math.random() * 360; this.rotationSpeed = (Math.random() - 0.5) * 2; } update() { this.y += this.speed; this.rotation += this.rotationSpeed; if (this.y > height) this.reset(); } draw() { ctx.save(); ctx.globalAlpha = this.opacity; ctx.fillStyle = this.color; ctx.font = `${this.size}px Arial`; ctx.translate(this.x, this.y); ctx.rotate(this.rotation * Math.PI / 180); ctx.fillText(this.text, 0, 0); ctx.restore(); } }
        function initParticles() { for (let i = 0; i < 50; i++) particles.push(new Particle()); } function animate() { ctx.clearRect(0, 0, width, height); particles.forEach(p => { p.update(); p.draw(); }); requestAnimationFrame(animate); } window.addEventListener('resize', () => { width = window.innerWidth; height = window.innerHeight; canvas.width = width; canvas.height = height; });
        const cursor = document.getElementById('cursor'); document.addEventListener('mousemove', (e) => { cursor.style.left = e.clientX + 'px'; cursor.style.top = e.clientY + 'px'; }); document.body.addEventListener('mouseover', (e) => { if(e.target.closest('.hover-target')) cursor.classList.add('hovered'); else cursor.classList.remove('hovered'); });

        // --- World Data Injection ---
        const worldData = {
            disboard: `<h3>DISBOARD (ç›˜ä¸Šä¸–ç•Œ)</h3><div class="world-text"><p>ä¸€åˆ‡éƒ½ç”±æ¸¸æˆå†³å®šçš„ä¸–ç•Œ...</p></div>`,
            history: `<h3>ARCHIVE (å¤å¤§æˆ˜)</h3><div class="world-text"><p>è¯¸ç¥äº‰å¤ºå”¯ä¸€ç¥å®åº§çš„è¿œå¤æˆ˜äº‰...</p></div>`,
            exceed: `
                <h3>IXSEED (åå…­ç§æ—)</h3>
                <div class="world-text"><p style="margin-bottom:20px;">å…¨æƒä»£ç†äººï¼šåå…­ç§æ—å„è‡ªå¯¹åº”å›½é™…è±¡æ£‹çš„ä¸€æšæ£‹å­ã€‚</p>
                <div class="exceed-board">
                    <div class="piece-card rank-1 hover-target"><div class="piece-rank">I</div><div class="piece-icon">â™”</div><div class="piece-info"><div class="piece-chess-role">King</div><div class="piece-name">Old Deus</div><div class="piece-jp-name">ç¥çµç§</div><div class="piece-desc">ä¸–ç•Œçš„æ ¸å¿ƒï¼Œå”¯ä¸€ç¥ç‰¹å›¾æ‰€åœ¨é˜¶çº§ã€‚</div></div></div>
                    <div class="piece-card rank-2 hover-target"><div class="piece-rank">II</div><div class="piece-icon">â™•</div><div class="piece-info"><div class="piece-chess-role">Queen</div><div class="piece-name">Phantasma</div><div class="piece-jp-name">å¹»æƒ³ç§</div><div class="piece-desc">ä¸–ç•Œè§„æ¨¡çš„ç”Ÿå‘½ä½“ï¼Œä»…å­˜ä¸€ä½ã€‚</div></div></div>
                    <div class="piece-card hover-target"><div class="piece-rank">III</div><div class="piece-icon">â™–</div><div class="piece-info"><div class="piece-chess-role">Rook</div><div class="piece-name">Dragonia</div><div class="piece-jp-name">é¾™ç²¾ç§</div><div class="piece-desc">é˜²å¾¡ä¸åŠ›é‡æé«˜çš„ç”Ÿç‰©å…µå™¨ã€‚</div></div></div>
                    <div class="piece-card hover-target"><div class="piece-rank">IV</div><div class="piece-icon">â™—</div><div class="piece-info"><div class="piece-chess-role">Bishop</div><div class="piece-name">FlÃ¼gel</div><div class="piece-jp-name">å¤©ç¿¼ç§</div><div class="piece-desc">é«˜é­”åŠ›ä¸çŸ¥è¯†ï¼Œæœ€å…·ç­ç»åŠ›ã€‚</div></div></div>
                    <div class="piece-card hover-target"><div class="piece-rank">V</div><div class="piece-icon">â™˜</div><div class="piece-info"><div class="piece-chess-role">Knight</div><div class="piece-name">Elf</div><div class="piece-jp-name">æ£®ç²¾ç§</div><div class="piece-desc">é­”æ³•çµæ´»æ€§æé«˜ï¼Œæœ€å¤§å›½å®¶ã€‚</div></div></div>
                    <div class="piece-card hover-target"><div class="piece-rank">VI</div><div class="piece-icon">â™™</div><div class="piece-info"><div class="piece-chess-role">Pawn (Promo)</div><div class="piece-name">Gigant</div><div class="piece-jp-name">å·¨ç¥ç§</div><div class="piece-desc">å¯æ— é™æå‡ï¼Œè±¡å¾å…µçš„å‡å˜ã€‚</div></div></div>
                    <div class="piece-card hover-target"><div class="piece-rank">VII</div><div class="piece-icon">ğŸ¨ </div><div class="piece-info"><div class="piece-chess-role">General</div><div class="piece-name">Werebeast</div><div class="piece-jp-name">å…½äººç§</div><div class="piece-desc">è±¡å¾å¼ºåŒ–å…µç±»ï¼Œæ„Ÿå®˜æ•é”ã€‚</div></div></div>
                    <div class="piece-card hover-target"><div class="piece-rank">VIII</div><div class="piece-icon">â™™</div><div class="piece-info"><div class="piece-chess-role">Pawn (Ext)</div><div class="piece-name">Goblin</div><div class="piece-jp-name">åœ°ç²¾ç§</div><div class="piece-desc">å¤šç§å½¢æ€åˆ†æ”¯ï¼Œé”»é€ æŠ€æœ¯å¼ºã€‚</div></div></div>
                    <div class="piece-card hover-target"><div class="piece-rank">IX</div><div class="piece-icon">â™–</div><div class="piece-info"><div class="piece-chess-role">Rook (Var)</div><div class="piece-name">Dragonblood</div><div class="piece-jp-name">å¤©é¾™ç§</div><div class="piece-desc">è±¡å¾åšå›ºä¸åŠ›é‡ã€‚</div></div></div>
                    <div class="piece-card hover-target"><div class="piece-rank">X</div><div class="piece-icon">â™—</div><div class="piece-info"><div class="piece-chess-role">Bishop (Var)</div><div class="piece-name">Demonia</div><div class="piece-jp-name">å¦–é­”ç§</div><div class="piece-desc">å¼ºé­”åŠ›ï¼Œè±¡å¾æ–œå‘å½±å“åŠ›ã€‚</div></div></div>
                    <div class="piece-card hover-target"><div class="piece-rank">XI</div><div class="piece-icon">â™•</div><div class="piece-info"><div class="piece-chess-role">Queen (Weak)</div><div class="piece-name">Seiren</div><div class="piece-jp-name">æµ·ç¥ç§</div><div class="piece-desc">ç”Ÿå‘½åŠ›ç¹ç››ï¼Œä¾é ä»–æ—ç¹æ®–ã€‚</div></div></div>
                    <div class="piece-card hover-target"><div class="piece-rank">XII</div><div class="piece-icon">â™˜</div><div class="piece-info"><div class="piece-chess-role">Knight (Var)</div><div class="piece-name">Fairy</div><div class="piece-jp-name">å¦–ç²¾ç§</div><div class="piece-desc">è·³è·ƒä¸ä¸å¯é¢„æµ‹çš„è¡ŒåŠ¨æ€§ã€‚</div></div></div>
                    <div class="piece-card hover-target"><div class="piece-rank">XIII</div><div class="piece-icon">â™œ</div><div class="piece-info"><div class="piece-chess-role">Rook+Bishop</div><div class="piece-name">Ex-Machina</div><div class="piece-jp-name">æœºæ¢°ç§</div><div class="piece-desc">é€»è¾‘ä¸ç«åŠ›ï¼Œåˆä½“æ£‹å­ã€‚</div></div></div>
                    <div class="piece-card hover-target"><div class="piece-rank">XIV</div><div class="piece-icon">â™™</div><div class="piece-info"><div class="piece-chess-role">Pawn (Spec)</div><div class="piece-name">Dhampir</div><div class="piece-jp-name">å¸è¡€é¬¼ç§</div><div class="piece-desc">é€šè¿‡å¸å–æ”¹å˜çŠ¶æ€ï¼Œè¿›åŒ–æ½œåŠ›ã€‚</div></div></div>
                    <div class="piece-card hover-target"><div class="piece-rank">XV</div><div class="piece-icon">â™™</div><div class="piece-info"><div class="piece-chess-role">Pawn (Var)</div><div class="piece-name">Moonver</div><div class="piece-jp-name">æœˆä¸‹å…½äºº</div><div class="piece-desc">ç‹¬ç‰¹æŠ€èƒ½ï¼Œä»å½’ä¸ºå…µé˜¶ã€‚</div></div></div>
                    <div class="piece-card rank-16 hover-target"><div class="piece-rank">XVI</div><div class="piece-icon">â™™</div><div class="piece-info"><div class="piece-chess-role">Pawn</div><div class="piece-name">Imanity</div><div class="piece-jp-name">äººç±»ç§</div><div class="piece-desc">æœ€å¼±ï¼Œä½†èƒ½å‡å˜ä¸ºä»»ä½•æ£‹å­ã€‚</div></div></div>
                </div></div>`
        };
        
        function renderWorld() { document.getElementById('world-display-area').innerHTML = worldData.disboard; }
        function switchWorldTab(tab) {
            const tabs = document.querySelectorAll('.world-tab'); tabs.forEach(t => t.classList.remove('active'));
            if(tab === 'disboard') tabs[0].classList.add('active'); else if(tab === 'exceed') tabs[1].classList.add('active'); else tabs[2].classList.add('active');
            const area = document.getElementById('world-display-area'); area.style.opacity = 0;
            setTimeout(() => { area.innerHTML = worldData[tab]; area.style.opacity = 1; }, 200);
        }

        function numToRoman(num) { const roman = {M:1000,CM:900,D:500,CD:400,C:100,XC:90,L:50,XL:40,X:10,IX:9,V:5,IV:4,I:1}; let str = ''; for(let i of Object.keys(roman)){ let q = Math.floor(num/roman[i]); num -= q*roman[i]; str += i.repeat(q); } return str; }
    </script>
</body>
</html>