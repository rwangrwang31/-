<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NO GAME NO LIFE | DISBOARD SYSTEM</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Noto+Sans+SC:wght@300;500;700&family=ZCOOL+XiaoWei&display=swap" rel="stylesheet">
    <style>
        /* ================= 0. Ê†∏ÂøÉÂèòÈáè‰∏éÂÖ®Â±ÄËÆæÂÆö ================= */
        :root {
            --pink: #ff2a6d; --cyan: #05d9e8; --purple: #d905e8; --gold: #ffd700;
            --dark: #05010d; --glass: rgba(20, 20, 35, 0.9); --border: rgba(255, 255, 255, 0.1);
            --rank-god: #ffd700; --rank- Fl√ºgel: #9b59b6; --rank-elf: #2ecc71; --rank-imanity: #e74c3c;
        }

        * { margin:0; padding:0; box-sizing:border-box; cursor:none; outline:none; user-select:none; }
        html { scroll-behavior: smooth; }
        body { background-color:var(--dark); color:white; font-family:'Noto Sans SC', sans-serif; height:100vh; overflow-x:hidden; }

        /* ================= 1. Âä®ÊÄÅÂÖâÊ†á‰∏éÂü∫Á°ÄÁªÑ‰ª∂ ================= */
        #cursor { width:25px; height:25px; border:2px solid var(--cyan); border-radius:50%; position:fixed; pointer-events:none; z-index:999999; transform:translate(-50%,-50%); transition: all 0.1s ease-out; mix-blend-mode:difference; }
        #cursor.hover { width:60px; height:60px; background:rgba(5, 217, 232, 0.2); border-color:var(--pink); }
        #cursor.click { transform:translate(-50%,-50%) scale(0.8); border-width: 4px; }
        
        ::-webkit-scrollbar { width:8px; } ::-webkit-scrollbar-track { background:transparent; } ::-webkit-scrollbar-thumb { background:linear-gradient(180deg, var(--pink), var(--purple), var(--cyan)); border-radius:4px; }
        
        .btn { background:transparent; border:2px solid var(--cyan); color:var(--cyan); padding:10px 25px; font-family:'Orbitron', sans-serif; font-weight:bold; transition:0.3s; position:relative; overflow:hidden; text-transform:uppercase; text-shadow: 0 0 5px var(--cyan); }
        .btn:hover { background:var(--cyan); color:black; box-shadow:0 0 25px var(--cyan), inset 0 0 10px rgba(255,255,255,0.5); transform:scale(1.05) translateY(-2px); text-shadow: none; }
        .btn:disabled { border-color:#444; color:#444; cursor:not-allowed; box-shadow:none; transform:none; text-shadow:none; }
        
        .input { width:100%; padding:14px; background:rgba(0,0,0,0.5); border:1px solid #444; color:white; font-family:'Orbitron', sans-serif; text-align:center; transition:0.3s; margin-bottom:15px; border-radius: 4px; }
        .input:focus { border-color:var(--cyan); box-shadow:0 0 15px rgba(5,217,232,0.3), inset 0 0 10px rgba(5,217,232,0.1); }

        .hidden { display:none !important; }
        .section-title { font-family:'Orbitron'; font-size: 2.5rem; text-align: center; margin-bottom: 50px; color: white; text-shadow: 0 0 15px var(--cyan); }

        /* ================= 2. Â∏ÉÂ±Ä‰∏éËÉåÊôØÁâπÊïà ================= */
        #app-container { transition: filter 0.5s ease-out, transform 0.5s ease-out; }
        body.auth-active #app-container { filter:blur(10px) brightness(0.4); transform: scale(0.98); pointer-events:none; }
        
        .bg-anim { position:fixed; inset:0; z-index:-10; background:radial-gradient(circle at 50% 0%, rgba(189,0,255,0.1), transparent 60%), url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%2305d9e8' fill-opacity='0.04'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E"); }
        #canvas-bg { position:fixed; inset:0; z-index:-5; opacity:0.6; }

        /* ================= 3. ÁôªÂΩï/Ê≥®ÂÜåÁ≥ªÁªü ================= */
        #auth-overlay { position:fixed; inset:0; z-index:20000; background:rgba(5,2,10,0.8); display:flex; justify-content:center; align-items:center; backdrop-filter: blur(5px); opacity:0; pointer-events:none; transition: opacity 0.5s; }
        #auth-overlay.active { opacity:1; pointer-events:all; }
        .auth-box { width:420px; padding:40px; background:rgba(0,0,0,0.7); border:2px solid var(--pink); box-shadow:0 0 60px rgba(255,42,109,0.4), inset 0 0 30px rgba(255,42,109,0.2); text-align:center; position:relative; animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity:0; transform: scale(0.9); } to { opacity:1; transform: scale(1); } }
        .auth-title { font-family:'Orbitron', sans-serif; font-size:2rem; margin-bottom:30px; color:white; text-shadow:0 0 10px var(--cyan); }
        .auth-link { font-size:0.8rem; color:#888; text-decoration:underline; margin-top:10px; display:inline-block; transition: 0.2s; }
        .auth-link:hover { color:var(--cyan); }
        .err-msg { color:var(--pink); margin-top:15px; font-family:'Orbitron'; font-size:0.8rem; min-height:20px; text-shadow: 0 0 5px var(--pink); }

        /* ================= 4. ‰∏ªÈ°µÊùøÂùó ================= */
        nav { position:fixed; top:0; width:100%; height:70px; padding:0 40px; display:flex; justify-content:space-between; align-items:center; z-index:1000; background:rgba(5,1,10,0.8); border-bottom:1px solid rgba(255,255,255,0.1); backdrop-filter: blur(10px); }
        .brand { font-family:'Orbitron', sans-serif; font-weight:900; font-size:1.5rem; color:white; text-shadow:0 0 10px var(--cyan), 0 0 20px var(--purple); }
        .nav-item { margin-left:30px; color:#aaa; text-decoration:none; font-family:'Orbitron'; font-size:0.9rem; transition:0.3s; position:relative; padding: 5px 0; }
        .nav-item:after { content:''; position: absolute; bottom: 0; left: 0; width: 0; height: 2px; background: var(--cyan); transition: width 0.3s; }
        .nav-item:hover { color:var(--cyan); text-shadow:0 0 8px var(--cyan); }
        .nav-item:hover:after { width: 100%; }
        
        .user-badge { border:2px solid var(--gold); padding:5px 15px; color:var(--gold); border-radius:4px; font-family:'Orbitron'; display:flex; gap:10px; align-items: center; transition: 0.3s; text-shadow: 0 0 8px var(--gold); }
        .user-badge:hover { background:rgba(255,215,0,0.1); box-shadow:0 0 15px rgba(255,215,0,0.3); transform: scale(1.05); }

        section { padding:120px 40px; max-width:1400px; margin:0 auto; }
        .hero { min-height:100vh; display:flex; flex-direction:column; justify-content:center; align-items:center; text-align:center; }
        h1 { font-family:'Orbitron', sans-serif; font-size:6rem; margin-bottom:20px; text-shadow:0 0 25px var(--pink), 0 0 40px var(--purple); animation:glitch 3s infinite alternate; }
        @keyframes glitch { 0%, 100% { text-shadow: 0 0 25px var(--pink), 0 0 40px var(--purple); } 49% { text-shadow: 0 0 25px var(--pink), 0 0 40px var(--purple); } 50% { transform: skew(-0.5deg); text-shadow: 2px 2px 0 var(--cyan), -2px -2px 0 var(--pink); } 51% { transform: skew(0.5deg); text-shadow: -2px 2px 0 var(--cyan), 2px -2px 0 var(--pink); } }
        
        /* Pledges */
        .grid { display:grid; grid-template-columns:repeat(auto-fit, minmax(350px, 1fr)); gap:25px; }
        .card { background:var(--glass); border:1px solid var(--border); padding:25px; border-radius:10px; transition:0.4s ease-out; position:relative; overflow:hidden; }
        .card:hover { transform:translateY(-10px) scale(1.02); border-color:var(--cyan); box-shadow:0 10px 30px rgba(5,217,232,0.2); }
        .card-num { font-family:'Orbitron'; font-size:5rem; opacity:0.08; position:absolute; right:15px; top: 5px; font-weight:900; transition: 0.4s; }
        .card:hover .card-num { opacity: 0.2; transform: rotate(-5deg); color: var(--cyan); }
        .card-title { font-family: 'ZCOOL XiaoWei', serif; font-size: 1.5rem; color: var(--pink); margin-bottom: 10px; }
        
        /* World (Ixseed) */
        .chess-grid { display:grid; grid-template-columns:repeat(auto-fill, minmax(250px, 1fr)); gap:20px; margin-top:30px; }
        .piece { height:240px; background:rgba(255,255,255,0.03); border:1px solid var(--border); padding:20px; border-radius:8px; display:flex; flex-direction:column; justify-content:flex-end; position:relative; overflow:hidden; transition:0.4s; }
        .piece:hover { transform:scale(1.08); background:rgba(255,255,255,0.08); z-index:5; box-shadow:0 10px 40px rgba(0,0,0,0.5); }
        .p-icon { position:absolute; bottom:-30px; right:-30px; font-size:10rem; opacity:0.05; transition:0.5s; font-family: initial; }
        .piece:hover .p-icon { opacity:0.15; transform:rotate(-15deg) scale(1.1); }
        .p-rank { font-family: 'Orbitron'; font-size: 1.2rem; }
        .p-name { font-size: 1.5rem; font-weight: bold; }
        .p-jname { color: #aaa; }
        .rank-1 { border-color:var(--gold); box-shadow:inset 0 0 25px rgba(255,215,0,0.2); } .rank-1 .p-name { color:var(--gold); }
        .rank-16:hover { animation:rainbow-border 2s infinite; border-color:white; }
        @keyframes rainbow-border { 0%{box-shadow:0 0 15px var(--pink);} 50%{box-shadow:0 0 15px var(--cyan);} 100%{box-shadow:0 0 15px var(--purple);} }

        /* Players */
        .char-gallery { display:flex; justify-content:center; gap:30px; flex-wrap:wrap; }
        .char { width:260px; height:380px; perspective:1000px; }
        .char-in { width:100%; height:100%; transition:0.6s; transform-style:preserve-3d; position:relative; }
        .char:hover .char-in { transform:rotateY(180deg); }
        .c-front, .c-back { position:absolute; inset:0; backface-visibility:hidden; border-radius:15px; display:flex; flex-direction:column; align-items:center; justify-content:center; background:linear-gradient(145deg, #1a1025, #050505); border:1px solid var(--border); box-shadow:0 10px 30px rgba(0,0,0,0.5); }
        .c-back { transform:rotateY(180deg); background:linear-gradient(135deg, var(--pink), #2a0e36); padding:20px; text-align:center; }
        .c-av { width:150px; height:150px; border-radius:50%; border:4px solid white; background-size:cover; background-position:center; margin-bottom:20px; box-shadow:0 0 25px var(--cyan), 0 0 40px var(--purple); transition: 0.4s; }
        .char:hover .c-av { transform: scale(1.1); }
        .char-name { font-family: 'Orbitron'; font-size: 1.5rem; }
        .char-race { color: var(--cyan); }
        .char-desc { font-size: 0.9rem; color: #ddd; margin-top: 15px; }

        /* ================= 5. USER SYSTEM (ÈáçÂà∂) ================= */
        #user-overlay { position:fixed; inset:0; z-index:8000; background:rgba(0,0,0,0.8); display:flex; justify-content:center; align-items:center; opacity:0; pointer-events:none; transition:0.5s; backdrop-filter: blur(8px); }
        #user-overlay.active { opacity:1; pointer-events:all; }
        .profile-ui { width:1000px; height:650px; background:#111; border:1px solid var(--cyan); display:flex; border-radius:10px; overflow:hidden; box-shadow:0 0 50px rgba(5,217,232,0.2); transform: scale(0.9); transition: transform 0.5s; }
        #user-overlay.active .profile-ui { transform: scale(1); }
        
        .p-side { width:280px; background:rgba(0,0,0,0.5); border-right:1px solid #333; display:flex; flex-direction:column; }
        .p-head { padding:20px; border-bottom:1px solid #333; font-family:'Orbitron'; color:var(--pink); display:flex; justify-content:space-between; align-items: center; }
        .p-head .btn { padding: 5px 10px; font-size: 0.8rem; }
        .f-list { flex:1; overflow-y:auto; }
        .f-item { padding:15px; border-bottom:1px solid #222; display:flex; align-items:center; gap:10px; transition:0.2s; position: relative; }
        .f-item:hover, .f-item.active { background:linear-gradient(90deg, rgba(5,217,232,0.2), transparent); border-right:3px solid var(--cyan); }
        .f-name { flex: 1; }
        .f-status { font-size: 0.7rem; color: #888; }
        .f-actions { display: flex; gap: 5px; }
        .f-actions .btn { padding: 3px 8px; font-size: 0.7rem; border-width: 1px; }

        .p-content { flex:1; display:flex; flex-direction:column; background:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40"><path d="M.5 20v-1M20 .5h1M39.5 20v1M20 39.5h-1" stroke-width="1" stroke="rgba(255,255,255,0.05)"/></svg>'); }
        /* Stats View */
        .stats-view { padding:40px; text-align:center; animation: fadeIn 0.5s; }
        .big-av { width:120px; height:120px; border-radius:50%; background:#333; border:3px solid var(--gold); margin:0 auto 20px; box-shadow: 0 0 20px var(--gold); }
        .stat-grid { display:flex; justify-content:center; gap:20px; margin:30px 0; }
        .stat-box { background:rgba(255,255,255,0.05); padding:20px; border-radius:8px; width:140px; text-align:center; border: 1px solid #333; transition: 0.3s; }
        .stat-box:hover { transform: translateY(-5px); background:rgba(255,255,255,0.1); }
        /* Chat View */
        .chat-view { display:flex; flex-direction:column; height:100%; animation: fadeIn 0.5s; }
        .chat-header { padding: 15px; border-bottom: 1px solid #333; font-family: 'Orbitron'; font-size: 1.2rem; color: var(--cyan); }
        .chat-box { flex:1; padding:20px; overflow-y:auto; display:flex; flex-direction:column; gap:15px; }
        .msg { max-width:70%; padding:10px 15px; border-radius:15px; font-size:0.9rem; line-height: 1.4; position: relative; animation: msg-in 0.3s; }
        @keyframes msg-in { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .msg.me { align-self:flex-end; background:linear-gradient(45deg, var(--cyan), #00b8c5); color:black; border-bottom-right-radius: 3px; }
        .msg.them { align-self:flex-start; background:#333; border:1px solid #444; border-bottom-left-radius: 3px; }
        .chat-input { height:60px; border-top:1px solid #333; padding:10px; display:flex; gap:10px; background:rgba(0,0,0,0.5); }

        /* ================= 6. NOVEL READER & DISCUSSION ================= */
        .modal-layer { position:fixed; inset:0; z-index:9000; background:rgba(5,5,10,0.98); display:flex; flex-direction:column; opacity:0; pointer-events:none; transition: all 0.5s; backdrop-filter: blur(5px); }
        .modal-layer.active { opacity:1; pointer-events:all; }
        .m-head { height:60px; background:rgba(0,0,0,0.5); border-bottom:1px solid #333; display:flex; justify-content:space-between; align-items:center; padding:0 30px; flex-shrink: 0; }
        .m-title { font-family: 'Orbitron'; color: var(--cyan); font-size: 1.2rem; }
        .m-body { flex:1; display:flex; overflow:hidden; }

        /* Reader: TOC Sidebar */
        .r-side-l { width:280px; background:rgba(0,0,0,0.3); border-right:1px solid #333; display:flex; flex-direction:column; }
        .toc-item:hover { color:white; background:rgba(5,217,232,0.1); border-left:3px solid var(--cyan); padding-left: 12px; }
        /* Reader: Text Area */
        .r-text-area { flex:1; display:flex; flex-direction:column; position:relative; }
        .r-content { flex:1; overflow-y:auto; padding:50px 8%; font-family:'ZCOOL XiaoWei', serif; font-size:1.5rem; line-height:2.4; color:#ddd; }
        /* Reader: Comment Sidebar */
        .r-side-r.open { width:360px; }
        /* Discussion Page */
        #discussion-page { padding: 40px; overflow-y: auto; max-width: 900px; margin: 0 auto; width: 100%; }
        .d-card { background:rgba(255,255,255,0.02); border:1px solid #333; padding:20px; margin-bottom:20px; border-radius: 8px; transition: 0.3s; }
        .d-card:hover { border-color: var(--purple); box-shadow: 0 0 15px rgba(217, 5, 232, 0.1); }
    </style>
</head>
<body id="body">
    <div id="cursor"></div>

    <!-- 1. AUTH OVERLAY -->
    <div id="auth-overlay">
        <div class="auth-box">
            <h2 id="auth-head" class="auth-title">SYSTEM LOGIN</h2>
            <!-- Login Form -->
            <div id="form-login">
                <input id="login-email" class="input" type="email" placeholder="EMAIL">
                <input id="login-pass" type="password" class="input" placeholder="PASSWORD">
                <button class="btn" style="width:100%" onclick="auth.login()">CONNECT</button>
                <div class="auth-link" onclick="ui.switchAuth('register')">New Player? Register</div>
            </div>
            <!-- Register Form Step 1 -->
            <div id="form-register" class="hidden">
                <input id="reg-user" class="input" placeholder="USERNAME">
                <input id="reg-email" class="input" type="email" placeholder="EMAIL">
                <input id="reg-pass" type="password" class="input" placeholder="PASSWORD">
                <button id="reg-code-btn" class="btn" style="width:100%" onclick="auth.requestCode()">GET CODE</button>
                <div class="auth-link" onclick="ui.switchAuth('login')">Already a Player? Login</div>
            </div>
            <!-- Register Form Step 2 -->
            <div id="form-confirm" class="hidden">
                <p style="color:#888; font-size:0.8rem; margin-bottom:10px;">Code sent to your email. (Test code: 123456)</p>
                <input id="reg-code" class="input" placeholder="VERIFICATION CODE">
                <button class="btn" style="width:100%" onclick="auth.register()">CONFIRM REGISTRATION</button>
                 <div class="auth-link" onclick="ui.switchAuth('register')">Back</div>
            </div>
            <div id="auth-msg" class="err-msg"></div>
        </div>
    </div>

    <!-- 2. MAIN APP CONTAINER -->
    <div id="app-container">
        <div class="bg-anim"></div>
        <canvas id="canvas-bg"></canvas>
        
        <nav>
            <div class="brand">DISBOARD</div>
            <div class="nav-links">
                <a href="#hero" class="nav-item">HOME</a>
                <a href="#pledges" class="nav-item">PLEDGES</a>
                <a href="#world" class="nav-item">WORLD</a>
                <a href="#players" class="nav-item">PLAYERS</a>
                <a href="#" onclick="ui.showModal('discussion-layer'); return false;" class="nav-item">DISCUSSION</a>
            </div>
            <div class="user-badge" onclick="ui.showModal('user-overlay')">
                <span id="hud-username">GUEST</span>
                <span id="hud-coins">ü™ô 0</span>
            </div>
        </nav>

        <header id="hero" class="hero">
            <h1>NO GAME NO LIFE</h1>
            <p style="color:#aaa; letter-spacing:2px; margin-bottom:40px;">„Äé„Åï„ÅÇ„ÄÅ„Ç≤„Éº„É†„ÇíÂßã„ÇÅ„Çà„ÅÜ„Äè‚Äî "Now, let the games begin."</p>
            <button class="btn" onclick="ui.showModal('reader-layer')">READ NOVEL</button>
        </header>

        <section id="pledges">
            <h2 class="section-title">THE TEN PLEDGES</h2>
            <div id="pledge-grid" class="grid"></div>
        </section>

        <section id="world">
            <h2 class="section-title">IXSEED (THE 16 RACES)</h2>
            <div class="chess-grid" id="race-grid"></div>
        </section>

        <section id="players">
            <h2 class="section-title">MAIN PLAYERS</h2>
            <div class="char-gallery" id="char-grid"></div>
        </section>
        
        <footer style="text-align:center; padding: 40px; color: #555; font-family: 'Orbitron';">
            <p>DISBOARD SYSTEM v31.0 - All rights reserved to their respective owners.</p>
        </footer>
    </div>

    <!-- 3. USER PROFILE MODAL -->
    <div id="user-overlay" class="modal-layer">
        <div class="profile-ui">
            <div class="p-side">
                <div class="p-head">
                    <span>SOCIAL</span> 
                    <button class="btn" onclick="social.addFriend()">+</button>
                </div>
                <div id="friend-list" class="f-list"></div>
                 <div style="padding: 10px; border-top: 1px solid #333;">
                    <button class="btn" style="width: 100%; border-color:var(--pink); color:var(--pink)" onclick="auth.logout()">LOGOUT</button>
                 </div>
            </div>
            <div class="p-content">
                <!-- My Stats View -->
                <div id="view-stats" class="stats-view">
                    <div class="big-av" id="profile-avatar"></div>
                    <h2 id="profile-name" style="color:var(--pink); font-family:'Orbitron'"></h2>
                    <div class="stat-grid">
                        <div class="stat-box"><div style="font-size:0.8rem; color:#888">RANK</div><div id="profile-rank" style="font-size:1.5rem"></div></div>
                        <div class="stat-box"><div style="font-size:0.8rem; color:#888">EXP</div><div id="profile-exp" style="font-size:1.5rem"></div></div>
                        <div class="stat-box"><div style="font-size:0.8rem; color:#888">COINS</div><div id="profile-coins" style="font-size:1.5rem"></div></div>
                    </div>
                    <p id="profile-bio" style="color:#aaa; max-width: 400px; margin: 0 auto;"></p>
                    <button class="btn" style="margin-top:30px;" onclick="ui.hideAllModals()">CLOSE</button>
                </div>
                <!-- Chat View -->
                <div id="view-chat" class="chat-view hidden">
                    <div id="chat-header" class="chat-header"></div>
                    <div id="chat-box" class="chat-box"></div>
                    <div class="chat-input">
                        <input id="msg-input" class="input" style="text-align:left; margin:0;" placeholder="Message..." onkeydown="if(event.key==='Enter')social.sendMessage()">
                        <button class="btn" onclick="social.sendMessage()">SEND</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 4. NOVEL READER MODAL -->
    <div id="reader-layer" class="modal-layer">
        <div class="m-head">
            <span class="m-title">ARCHIVE</span>
            <div>
                <input type="file" id="file-input" accept=".txt" class="hidden" onchange="reader.loadFile(event)">
                <button class="btn" onclick="document.getElementById('file-input').click()">LOAD TXT</button>
                <button class="btn" style="border-color:var(--pink); color:var(--pink); margin-left: 10px;" onclick="ui.hideAllModals()">EXIT</button>
            </div>
        </div>
        <div id="reader-body" class="m-body">
             <div class="r-text-area" style="width: 100%; justify-content: center; align-items: center; text-align: center;">
                <p style="font-size: 1.5rem; color: #888;">Please load a .txt novel file to begin reading.</p>
             </div>
        </div>
    </div>

    <!-- 5. DISCUSSION MODAL -->
    <div id="discussion-layer" class="modal-layer">
        <div class="m-head">
            <span class="m-title">DISCUSSION FORUM</span>
            <button class="btn" style="border-color:var(--pink); color:var(--pink);" onclick="ui.hideAllModals()">CLOSE</button>
        </div>
        <div class="m-body">
            <div id="discussion-page">
                <div class="post-box" style="margin-bottom: 40px;">
                    <textarea id="discussion-input" class="input" rows="3" style="text-align:left; margin:0;" placeholder="Join the discussion..."></textarea>
                    <button class="btn" style="width: 100%; margin-top: 10px;" onclick="community.postDiscussion()">POST (+10 EXP, +2 COINS)</button>
                </div>
                <div id="discussion-list"></div>
            </div>
        </div>
    </div>

<script>
    // =================================================
    // NGNL SYSTEM FRONTEND v31.1 (ULTIMATE & UNIFIED)
    // =================================================
    
    // --- ‚ö†Ô∏è CONFIGURATION ---
    const API_URL = "https://script.google.com/macros/s/AKfycbxJBrAx1_jzwNCO6kCSVyJsNANGE4ibdXy5SXva_p54B4Zot8OaJeCm3PdQsIVhdU4v/exec"; // ÔºÅÔºÅÔºÅËØ∑Âä°ÂøÖÊõøÊç¢Êàê‰Ω†Ëá™Â∑±ÁöÑÂêéÁ´ØURL ÔºÅÔºÅÔºÅ
    
    // --- STATE MANAGEMENT ---
    const state = {
        user: { name: "Guest", rank: 16, exp: 0, coins: 0, bio: "", avatar: "" },
        isLoggedIn: false,
        activeChat: null,
        currentNovelLine: -1,
    };
    
    // --- API HELPER ---
    async function apiRequest(payload) {
        if (!API_URL.startsWith('https://')) {
            ui.showAuthError("API URL is not configured. Please paste your Google Script URL in the script.");
            return { status: 'error', message: 'API URL not configured.' };
        }
        // Add the current user to the payload if logged in, for actions that need it
        if (state.isLoggedIn) {
            payload.username = state.user.name;
        }
        try {
            console.log("TX:", payload);
            const response = await fetch(API_URL, {
                method: 'POST',
                mode: 'cors',
                cache: 'no-cache',
                headers: { 'Content-Type': 'text/plain;charset=utf-8' },
                body: JSON.stringify(payload),
                redirect: 'follow'
            });
            const result = await response.json();
            console.log("RX:", result);
            return result;
        } catch (error) {
            console.error("API Error:", error);
            ui.showAuthError("Network or Server Error. Check console (F12) for details.");
            return { status: 'error', message: 'Network or server error.' };
        }
    }

    // --- MODULE: UI ---
    const ui = {
        elements: {
            authOverlay: document.getElementById('auth-overlay'),
            body: document.getElementById('body'),
            authMsg: document.getElementById('auth-msg'),
            hudUsername: document.getElementById('hud-username'),
            hudCoins: document.getElementById('hud-coins'),
        },
        showModal(modalId) {
            if (!state.isLoggedIn && modalId !== 'auth-overlay') {
                alert("Please log in to access this feature.");
                this.elements.body.classList.add('auth-active');
                this.elements.authOverlay.classList.add('active');
                return;
            }
            this.hideAllModals();
            const modal = document.getElementById(modalId);
            modal.classList.add('active');
            // Specific actions on modal open
            if (modalId === 'user-overlay') social.init();
            if (modalId === 'discussion-layer') community.loadDiscussions();
        },
        hideAllModals() {
            document.querySelectorAll('.modal-layer').forEach(m => m.classList.remove('active'));
        },
        switchAuth(view) {
            ['login', 'register', 'confirm'].forEach(id => document.getElementById('form-' + id).classList.add('hidden'));
            document.getElementById('form-' + view).classList.remove('hidden');
            document.getElementById('auth-head').innerText = view === 'login' ? 'SYSTEM LOGIN' : 'PLAYER REGISTRATION';
            this.elements.authMsg.innerText = '';
        },
        showAuthError(msg) { this.elements.authMsg.innerText = msg; },
        updateHUD() {
            this.elements.hudUsername.innerText = state.user.name.toUpperCase();
            this.elements.hudCoins.innerText = `ü™ô ${state.user.coins}`;
        },
        updateProfileView() {
            document.getElementById('profile-name').innerText = state.user.name;
            document.getElementById('profile-rank').innerText = state.user.rank;
            document.getElementById('profile-exp').innerText = `${state.user.exp} / 100`;
            document.getElementById('profile-coins').innerText = state.user.coins;
            document.getElementById('profile-bio').innerText = state.user.bio;
        },
    };

    // --- MODULE: AUTHENTICATION ---
    const auth = {
        tempRegData: {},
        async login() {
            const email = document.getElementById('login-email').value.trim();
            const password = document.getElementById('login-pass').value;
            if (!email || !password) return ui.showAuthError("Email and password are required.");
            
            ui.showAuthError("Connecting...");
            const res = await apiRequest({ action: 'login', email, password });
            if (res.status === 'success') {
                state.user = { name: res.username, rank: res.level, exp: res.exp, coins: res.coins, bio: res.bio, avatar: res.avatar };
                state.isLoggedIn = true;
                sessionStorage.setItem('ngnlUser', JSON.stringify(state.user));
                ui.elements.authOverlay.classList.remove('active');
                ui.elements.body.classList.remove('auth-active');
                ui.updateHUD();
                ui.showAuthError("");
            } else {
                ui.showAuthError(res.message);
            }
        },
        async requestCode() {
            const user = document.getElementById('reg-user').value.trim();
            const email = document.getElementById('reg-email').value.trim();
            const pass = document.getElementById('reg-pass').value;
            if(!user || !email || !pass) return ui.showAuthError("All fields are required.");
            if(pass.length < 6) return ui.showAuthError("Password must be at least 6 characters long.");

            const codeBtn = document.getElementById('reg-code-btn');
            codeBtn.disabled = true;
            codeBtn.innerText = "REQUESTING...";
            ui.showAuthError("Requesting code...");

            const res = await apiRequest({ action: 'request_code', email });
            
            codeBtn.disabled = false;
            codeBtn.innerText = "GET CODE";

            if(res.status === 'success') {
                this.tempRegData = { user, email, pass };
                ui.switchAuth('confirm');
                alert(res.message);
            } else {
                ui.showAuthError(res.message);
            }
        },
        async register() {
            const code = document.getElementById('reg-code').value.trim();
            if(!code) return ui.showAuthError("Verification code is required.");
            
            ui.showAuthError("Registering...");
            const payload = {
                action: 'register',
                username: this.tempRegData.user,
                email: this.tempRegData.email,
                password: this.tempRegData.pass,
                code: code
            };
            const res = await apiRequest(payload);
            if(res.status === 'success') {
                alert("Registration successful! „ÄéWelcome to Disboard!„Äè Please log in.");
                ui.switchAuth('login');
            } else {
                ui.showAuthError(res.message);
            }
        },
        logout() {
            if(confirm("Are you sure you want to log out?")) {
                sessionStorage.removeItem('ngnlUser');
                window.location.reload();
            }
        }
    };
    
    // --- MODULE: SOCIAL & FRIENDS ---
    const social = {
        init() {
            this.loadFriends();
            ui.updateProfileView();
            document.getElementById('view-stats').classList.remove('hidden');
            document.getElementById('view-chat').classList.add('hidden');
        },
        async loadFriends() {
            const listEl = document.getElementById('friend-list');
            listEl.innerHTML = `<div class="f-item">Loading friends...</div>`;
            const res = await apiRequest({ action: 'get_friends' });
            let html = `<div class="f-item active" onclick="social.showMyStats(event)"><span class="f-name">MY PROFILE</span></div>`;
            if (res.status === 'success' && res.data) {
                res.data.forEach(f => {
                    html += `<div class="f-item" data-name="${f.name}">
                        <span class="f-name" onclick="social.startChat('${f.name}', event)">${f.name}</span>
                        ${this.getFriendStatusUI(f)}
                    </div>`;
                });
            }
            listEl.innerHTML = html;
        },
        getFriendStatusUI(friend) {
            if (friend.status === 'Accepted') return `<span class="f-status" style="color:var(--cyan)">FRIEND</span>`;
            if (friend.status === 'Sent') return `<span class="f-status">SENT</span>`;
            if (friend.status === 'Received') {
                return `<div class="f-actions">
                    <button class="btn" onclick="social.handleFriendRequest('${friend.name}', 'Accepted')">‚úì</button>
                    <button class="btn" style="border-color:var(--pink); color:var(--pink)" onclick="social.handleFriendRequest('${friend.name}', 'Declined')">√ó</button>
                </div>`;
            }
            return '';
        },
        async handleFriendRequest(targetUser, status) {
            const res = await apiRequest({ action: 'update_friend_status', target_user: targetUser, new_status: status });
            alert(res.message);
            if (res.status === 'success') this.loadFriends();
        },
        showMyStats(event) {
            document.getElementById('view-stats').classList.remove('hidden');
            document.getElementById('view-chat').classList.add('hidden');
            document.querySelectorAll('#friend-list .f-item').forEach(el => el.classList.remove('active'));
            event.currentTarget.classList.add('active');
        },
        async addFriend() {
            const name = prompt("Enter the player's name to send a friend request:");
            if(name && name.trim()) {
                const res = await apiRequest({ action: 'add_friend', target_user: name.trim() });
                alert(res.message);
                if(res.status === 'success') this.loadFriends();
            }
        },
        startChat(target, event) {
            state.activeChat = target;
            document.getElementById('view-stats').classList.add('hidden');
            document.getElementById('view-chat').classList.remove('hidden');
            document.getElementById('chat-header').innerText = `Chat with ${target}`;
            document.querySelectorAll('#friend-list .f-item').forEach(el => el.classList.remove('active'));
            event.currentTarget.closest('.f-item').classList.add('active');
            this.loadMessages();
        },
        async loadMessages() {
            if (!state.activeChat) return;
            const box = document.getElementById('chat-box');
            box.innerHTML = "Loading messages...";
            const res = await apiRequest({ action: 'get_messages', target_user: state.activeChat });
            if(res.status === 'success' && res.data) {
                box.innerHTML = res.data.map(m => `<div class="msg ${m.sender === state.user.name ? 'me' : 'them'}">${m.content}</div>`).join('') || "No messages yet. Say hi!";
                box.scrollTop = box.scrollHeight;
            }
        },
        async sendMessage() {
            const input = document.getElementById('msg-input');
            const content = input.value.trim();
            if (!content || !state.activeChat) return;
            // Optimistic UI update
            const box = document.getElementById('chat-box');
            box.innerHTML += `<div class="msg me">${content}</div>`;
            box.scrollTop = box.scrollHeight;
            input.value = "";

            await apiRequest({ action: 'send_message', target_user: state.activeChat, content });
            // Don't need to reload, message already shown
        }
    };

    // --- MODULE: COMMUNITY (Discussion/Comments) ---
    const community = {
        async loadDiscussions() {
            const listEl = document.getElementById('discussion-list');
            listEl.innerHTML = '<p style="text-align:center; color:#888;">Loading discussions...</p>';
            const res = await apiRequest({ action: 'get_discussions' });
            if (res.status === 'success' && res.data) {
                listEl.innerHTML = res.data.map(d => `
                    <div class="d-card">
                        <div style="color:var(--cyan); border-bottom:1px solid #333; padding-bottom:10px; margin-bottom: 10px; display:flex; justify-content:space-between">
                            <span>${d.user}</span>
                            <span style="color:#888; font-size: 0.8rem;">${d.time}</span>
                        </div>
                        <div style="margin:10px 0; font-size:1.1rem; color: #eee; white-space: pre-wrap;">${d.content}</div>
                        <div class="act-bar" style="display:flex; gap:20px; font-size:0.8rem; color:#888; margin-top:15px; align-items:center;">
                            <span class="act-btn" style="transition:0.2s; color: #aaa;" onmouseover="this.style.color='var(--pink)'" onmouseout="this.style.color='#aaa'" onclick="community.interact('like','${d.id}','disc')">‚ô• ${d.likes} Like</span>
                            <span class="act-btn" style="transition:0.2s; color: #aaa;" onmouseover="this.style.color='var(--gold)'" onmouseout="this.style.color='#aaa'" onclick="community.interact('tip','${d.id}','disc')">ü™ô ${d.coins} Tip</span>
                        </div>
                    </div>
                `).join('') || '<p style="text-align:center; color:#888;">No discussions yet. Be the first to post!</p>';
            }
        },
        async postDiscussion() {
            const input = document.getElementById('discussion-input');
            const content = input.value.trim();
            if(!content) return;
            input.disabled = true;
            await apiRequest({ action: 'post_discussion', content });
            input.value = "";
            input.disabled = false;
            this.loadDiscussions();
        },
        async interact(subAction, id, type) {
            if (!state.isLoggedIn) return alert("Login required to interact.");
            if (subAction === 'tip' && !confirm("Spend 1 coin to tip this post?")) return;
            
            const res = await apiRequest({ action: 'interact', sub_action: subAction, type: type, id: id });
            if (res.status === 'success') {
                if (subAction === 'tip') {
                    state.user.coins = res.new_balance;
                    sessionStorage.setItem('ngnlUser', JSON.stringify(state.user)); // Update session storage
                    ui.updateHUD();
                }
                if (type === 'disc') this.loadDiscussions();
            } else {
                alert(res.message);
            }
        }
    };
    
    // --- MODULE: NOVEL READER ---
    const reader = {
        loadFile(event) {
            const input = event.target;
            if (input.files && input.files[0]) {
                const fileReader = new FileReader();
                fileReader.onload = (e) => {
                    const content = e.target.result;
                    document.getElementById('reader-body').innerHTML = `
                    <div class="r-text-area" style="width: 100%;">
                       <div class="r-content" style="white-space: pre-wrap;">${content}</div>
                    </div>`;
                    alert(`Novel "${input.files[0].name}" loaded successfully.`);
                };
                fileReader.readAsText(input.files[0]);
            }
            input.value = ''; // Reset file input to allow re-uploading the same file
        }
    };
    
    // --- MODULE: VISUALS & INITIAL CONTENT ---
    const visuals = {
        init() {
            this.initPledges();
            this.initRaces();
            this.initPlayers();
            this.initCursor();
            this.initCanvas();
        },
        initPledges() {
            const pledges = [
                { title: '‰∏Ä„ÄÅÁ¶ÅÊ≠¢‰∏ÄÂàáÊùÄ‰º§„ÄÅÊàò‰∫â„ÄÅÊä¢Â§∫', text: 'ÊâÄÊúâÊö¥ÂäõÂÜ≤Á™ÅÁöÜË¢´Á¶ÅÊ≠¢„ÄÇ' },
                { title: '‰∫å„ÄÅÁ∫†Á∫∑‰∏ÄÂæãÈÄöËøáÂú®Ê∏∏Êàè‰∏≠ËÉúÂá∫Êù•Ëß£ÂÜ≥', text: 'ÊâÄÊúâÂΩ¢ÂºèÁöÑÂÜ≤Á™ÅÂíåÂàÜÊ≠ßÔºåÈÉΩÂøÖÈ°ªÈÄöËøáÊ∏∏ÊàèÊù•Ëß£ÂÜ≥„ÄÇ' },
                { title: '‰∏â„ÄÅÊ∏∏Êàè‰∏≠ÔºåÂèåÊñπË¶ÅËµå‰∏äÂØπÁ≠âÁöÑËµåÊ≥®', text: 'ËµåÊ≥®ÂèØ‰ª•Ë∂ÖË∂äÂ∏∏ËØÜÔºåÁîöËá≥ÂåÖÊã¨ÁîüÂëΩÊàñÁßçÊóèÂ≠ò‰∫°„ÄÇ' },
                { title: 'Âõõ„ÄÅÂú®‰∏çËøùÂèçÁ¨¨‰∏âÊù°ÁöÑÊÉÖÂÜµ‰∏ãÔºåÊ∏∏ÊàèÂÜÖÂÆπ„ÄÅËµåÊ≥®ÁöÜ‰∏çÂèóÈôêÂà∂', text: 'Âè™Ë¶ÅÂèåÊñπÂêåÊÑèÔºå‰ªª‰ΩïÊ∏∏Êàè„ÄÅ‰ªª‰ΩïËµåÊ≥®ÈÉΩÊòØÂÖÅËÆ∏ÁöÑ„ÄÇ' },
                { title: '‰∫î„ÄÅÂèóÊåëÊàòÁöÑ‰∏ÄÊñπÔºåÊúâÊùÉÂÜ≥ÂÆöÊ∏∏ÊàèÂÜÖÂÆπ', text: 'ËøôÁªô‰∫à‰∫ÜË¢´ÊåëÊàòËÄÖ‰∏ÄÂÆöÁöÑÊàòÁï•‰ºòÂäø„ÄÇ' },
                { title: 'ÂÖ≠„ÄÅ‚ÄúÂêëÁõüÁ∫¶ÂÆ£Ë™ì‚ÄùÁöÑÊâìËµåÔºåÁªùÂØπË¶ÅÈÅµÂÆà', text: '‰∏ÄÊó¶‰ª•ÁõüÁ∫¶‰πãÂêçËµ∑Ë™ìÔºåÂ∞±ÂøÖÈ°ªÂ±•Ë°åËØ∫Ë®Ä„ÄÇ' },
                { title: '‰∏É„ÄÅÈõÜÂõ¢Èó¥ÁöÑÁ∫†Á∫∑ÔºåÁî±ÂÖ®ÊùÉ‰ª£ÁêÜ‰∫∫ËøõË°åÊ∏∏Êàè', text: 'ÂõΩÂÆ∂ÊàñÁßçÊóè‰πãÈó¥ÁöÑÊ∏∏ÊàèÔºåÁî±ÊåáÂÆöÁöÑ‰ª£Ë°®ËøõË°å„ÄÇ' },
                { title: 'ÂÖ´„ÄÅÊ∏∏ÊàèÂΩì‰∏≠Ôºå‰∏ÄÊó¶Ë¢´ÂèëÁé∞Êúâ‰∏çÊ≠£ÂΩìË°å‰∏∫ÔºåÂç≥‰∏∫Ë¥•Âåó', text: '‰ΩúÂºäË¢´Êè≠ÂèëÔºåÂàôÁ´ãÂàªËæìÊéâÊ∏∏Êàè„ÄÇ' },
                { title: '‰πù„ÄÅ‰ª•Á•û‰πãÂêçÂÆ£Â∏ÉÔºå‰ª•‰∏äËßÑÂàôÁöÜ‰∏∫ÁªùÂØπ‰∏çÂèò', text: 'ËøôÊòØÁî±ÂîØ‰∏ÄÁ•ûÁâπÂõæÂà∂ÂÆöÁöÑÔºåÊó†Ê≥ïÊîπÂèòÁöÑ‰∏ñÁïåÊ≥ïÂàô„ÄÇ' },
                { title: 'ÂçÅ„ÄÅÂ§ßÂÆ∂‰∏ÄËµ∑ÂíåÂπ≥Âú∞Áé©Ê∏∏ÊàèÂêßÔºÅ', text: 'ËøôÊòØÁõüÁ∫¶ÁöÑÊ†∏ÂøÉÁ≤æÁ•ûÔºåÊó®Âú®ÂàõÈÄ†‰∏Ä‰∏™Ê≤°ÊúâÊàò‰∫âÁöÑ‰∏ñÁïå„ÄÇ' },
            ];
            document.getElementById('pledge-grid').innerHTML = pledges.map((p, i) => `
                <div class="card">
                    <div class="card-num">${i + 1}</div>
                    <h3 class="card-title">${p.title}</h3>
                    <p>${p.text}</p>
                </div>`).join('');
        },
        initRaces() {
             const races = [
                {r:'I',n:'Old Deus',j:'Á•ûÁÅµÁßç',c:'‚ôî',cls:'rank-1'},{r:'II',n:'Phantasma',j:'ÂπªÊÉ≥Áßç',c:'‚ôï'},{r:'III',n:'Dragonia',j:'ÈæôÁ≤æÁßç',c:'‚ôñ'},
                {r:'IV',n:'Gigant',j:'Â∑®‰∫∫Áßç',c:'‚ôô'},{r:'V',n:'Fl√ºgel',j:'Â§©ÁøºÁßç',c:'‚ôó'},{r:'VI',n:'Elf',j:'Ê£ÆÁ≤æÁßç',c:'‚ôò'},
                {r:'VII',n:'Dwarf',j:'Âú∞Á≤æÁßç',c:'‚ôô'},{r:'VIII',n:'Fairy',j:'Â¶ñÁ≤æÁßç',c:'‚ôò'},{r:'IX',n:'Ex-Machina',j:'Êú∫ÂáØÁßç',c:'‚ôú'},
                {r:'X',n:'Demonia',j:'Â¶ñÈ≠îÁßç',c:'‚ôó'},{r:'XI',n:'Dhampir',j:'Âê∏Ë°ÄÁßç',c:'‚ôô'},{r:'XII',n:'Lunamana',j:'ÊúàÂíèÁßç',c:'‚ôô'},
                {r:'XIII',n:'Werebeast',j:'ÂÖΩ‰∫∫Áßç',c:'ü®†'},{r:'XIV',n:'Seiren',j:'Êµ∑Ê†ñÁßç',c:'‚ôï'},{r:'XV',n:'Laphnil',j:'??Áßç',c:'‚ôô'},
                {r:'XVI',n:'Imanity',j:'‰∫∫Á±ªÁßç',c:'‚ôô',cls:'rank-16'}
            ];
            document.getElementById('race-grid').innerHTML = races.map(r => `
                <div class="piece ${r.cls||''}">
                    <div class="p-icon">${r.c}</div>
                    <div style="z-index:1">
                        <div class="p-rank">Rank ${r.r}</div>
                        <div class="p-name">${r.n}</div>
                        <div class="p-jname">${r.j}</div>
                    </div>
                </div>`).join('');
        },
        initPlayers() {
            const players = [
                {n:'SORA',r:'Imanity',i:'https://i.imgur.com/8Q8E2a2.png', d: '„Äé „ÄèÁöÑÁî∑ÊÄßÁé©ÂÆ∂ÔºåÊìÖÈïøÂøÉÁêÜÊàòÂíåÁ≠ñÁï•ÔºåÂØπ‰∫∫Á±ªÊä±ÊúâÊó†‰∏é‰º¶ÊØîÁöÑ‰ø°‰ªª„ÄÇ'},
                {n:'SHIRO',r:'Imanity',i:'https://i.imgur.com/5J3b3dJ.png', d: '„Äé „ÄèÁöÑÂ•≥ÊÄßÁé©ÂÆ∂ÔºåÊã•ÊúâË∂Ö‰πéÂ∏∏‰∫∫ÁöÑËÆ°ÁÆóËÉΩÂäõÔºåÊòØ‰∏Ä‰ΩçÊ∏∏ÊàèÂ§©Êâç„ÄÇ'},
                {n:'JIBRIL',r:'Fl√ºgel',i:'https://i.imgur.com/oWk4s4Y.png', d: 'Â§©ÁøºÁßçÔºåÂØπÁü•ËØÜÊúâÁùÄÊûÅÁ´ØÁöÑÊ∏¥ÊúõÔºåÊã•ÊúâÂº∫Â§ßÁöÑÊàòÊñóÂäõ„ÄÇ'},
                {n:'STEPH',r:'Imanity',i:'https://i.imgur.com/E8w6V2a.png', d: 'ËâæÂ∞îÂ•á‰∫öÂÖàÁéãÁöÑÂ≠ôÂ•≥ÔºåËôΩÁÑ∂Ê∏∏ÊàèËÉΩÂäõÂπ≥Â∫∏Ôºå‰ΩÜÂÜÖÊîøËÉΩÂäõÂá∫‰ºóÔºåÊòØ„Äé „ÄèÂèØÈù†ÁöÑ‰ºô‰º¥„ÄÇ'},
                {n:'IZUNA',r:'Werebeast',i:'https://i.imgur.com/t4x7yL5.png', d: 'ÂÖΩ‰∫∫ÁßçÁöÑÂ∞ëÂ•≥ÔºåÊã•Êúâ‚ÄúË°ÄÂùè‚ÄùËÉΩÂäõÔºåÂú®Ê∏∏Êàè‰∏≠Â±ïÁé∞Âá∫ÊÉä‰∫∫ÁöÑÁõ¥ËßâÂíåÂÆûÂäõ„ÄÇ'},
                {n:'TET',r:'Old Deus',i:'https://i.imgur.com/U3F2A0I.png', d: 'Ê∏∏Êàè‰πãÁ•ûÔºåÂ∞ÜÂçÅÂÖ≠ÁßçÊóèÂè¨Âî§Âà∞ÂºÇ‰∏ñÁïåÂπ∂Âà∂ÂÆö‰∫Ü‚ÄúÂçÅÊù°ÁõüÁ∫¶‚ÄùÁöÑÂîØ‰∏ÄÁ•û„ÄÇ'}
            ];
            document.getElementById('char-grid').innerHTML = players.map(p => `
                <div class="char">
                    <div class="char-in">
                        <div class="c-front">
                            <div class="c-av" style="background-image:url(${p.i})"></div>
                            <div class="char-name">${p.n}</div>
                            <div class="char-race">${p.r}</div>
                        </div>
                        <div class="c-back">
                            <h3>${p.n}</h3>
                            <p class="char-desc">${p.d}</p>
                        </div>
                    </div>
                </div>`).join('');
        },
        initCursor() {
            const cursor = document.getElementById('cursor');
            document.addEventListener('mousemove', e => {
                cursor.style.left = e.clientX + 'px';
                cursor.style.top = e.clientY + 'px';
            });
            document.body.addEventListener('mouseover', e => {
                if (e.target.closest('a, button, .btn, .card, .piece, .char, .f-item, .auth-link, [onclick]')) {
                    cursor.classList.add('hover');
                } else {
                    cursor.classList.remove('hover');
                }
            });
             document.addEventListener('mousedown', () => cursor.classList.add('click'));
             document.addEventListener('mouseup', () => cursor.classList.remove('click'));
        },
        initCanvas() {
            const cvs = document.getElementById('canvas-bg'), ctx = cvs.getContext('2d');
            let w = window.innerWidth, h = window.innerHeight;
            cvs.width = w; cvs.height = h;
            const particles = Array.from({ length: 50 }, () => ({
                x: Math.random() * w,
                y: Math.random() * h,
                s: Math.random() * 0.5 + 0.2,
                char: ['‚ôî', '‚ôï', '‚ôñ', '‚ôó', '‚ôò', '‚ôô'][Math.floor(Math.random() * 6)],
                opacity: Math.random() * 0.3 + 0.1
            }));
            function loop() {
                ctx.clearRect(0, 0, w, h);
                particles.forEach(p => {
                    p.y -= p.s;
                    if (p.y < -30) {
                        p.y = h + 30;
                        p.x = Math.random() * w;
                    }
                    ctx.fillStyle = `rgba(255, 255, 255, ${p.opacity})`;
                    ctx.font = '25px Arial';
                    ctx.fillText(p.char, p.x, p.y);
                });
                requestAnimationFrame(loop);
            }
            requestAnimationFrame(loop);
            window.addEventListener('resize', () => {
                w = window.innerWidth;
                h = window.innerHeight;
                cvs.width = w;
                cvs.height = h;
            });
        }
    };

    // --- INITIALIZATION ---
    document.addEventListener('DOMContentLoaded', () => {
        visuals.init();
        const storedUser = sessionStorage.getItem('ngnlUser');
        if (storedUser) {
            try {
                state.user = JSON.parse(storedUser);
                state.isLoggedIn = true;
                document.getElementById('body').classList.remove('auth-active');
                document.getElementById('auth-overlay').classList.remove('active');
                ui.updateHUD();
            } catch (e) {
                console.error("Failed to parse stored user data:", e);
                sessionStorage.removeItem('ngnlUser');
                document.getElementById('body').classList.add('auth-active');
                document.getElementById('auth-overlay').classList.add('active');
            }
        } else {
            document.getElementById('body').classList.add('auth-active');
            document.getElementById('auth-overlay').classList.add('active');
        }
    });

</script>
</body>
</html>